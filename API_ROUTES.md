# å¾®ä¿¡å°ç¨‹åºAPIè·¯ç”±æ–‡æ¡£ - ç®¡ç†å‘˜åå°å¼€å‘æŒ‡å—

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªå¾®ä¿¡å°ç¨‹åºå­¦ä¹ åº”ç”¨çš„åç«¯APIç³»ç»Ÿï¼Œæä¾›ç”¨æˆ·ç®¡ç†ã€å•†åŸåŠŸèƒ½ã€å­¦ä¹ è¿›åº¦è·Ÿè¸ªã€æ¨èç³»ç»Ÿã€ä»£ç†ç³»ç»Ÿä»¥åŠ**ç®¡ç†å‘˜åå°**ç­‰å®Œæ•´åŠŸèƒ½ã€‚

### æŠ€æœ¯æ ˆ
- **åç«¯æ¡†æ¶**: Go + Gin 
- **æ•°æ®åº“**: MongoDB
- **è®¤è¯æ–¹å¼**: JWT Token + å¾®ä¿¡ç™»å½•
- **æƒé™æ§åˆ¶**: åŸºäºç”¨æˆ·è§’è‰²çš„æƒé™éªŒè¯
- **APIæ–‡æ¡£**: OpenAPI 3.0

### æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
1. **ç”¨æˆ·è®¤è¯ç³»ç»Ÿ** - å¾®ä¿¡ç™»å½•ã€JWT Tokenç®¡ç†
2. **å•†åŸç³»ç»Ÿ** - å•†å“å±•ç¤ºã€è´­ç‰©è½¦ã€è®¢å•ç®¡ç†ã€æ”¯ä»˜
3. **å­¦ä¹ ç³»ç»Ÿ** - ä¹¦ç±ç®¡ç†ã€å•è¯å¡ç‰‡ã€å­¦ä¹ è¿›åº¦
4. **æ¨èç³»ç»Ÿ** - æ¨èç ã€ä½£é‡‘è®¡ç®—
5. **ä»£ç†ç³»ç»Ÿ** - æ ¡ä»£ç†ã€åŒºä»£ç†ç®¡ç†
6. **ğŸ¯ ç®¡ç†å‘˜åå°** - ç”¨æˆ·ç®¡ç†ã€å•†å“ç®¡ç†ã€ä»£ç†ç®¡ç†ï¼ˆ**é‡ç‚¹å¼€å‘æ¨¡å—**ï¼‰

### ç®¡ç†å‘˜åå°åŠŸèƒ½è¯¦è¿°
ç®¡ç†å‘˜åå°æ˜¯ä¸ºç³»ç»Ÿç®¡ç†å‘˜è®¾è®¡çš„Webç®¡ç†ç•Œé¢ï¼Œå…·å¤‡ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

#### ğŸ‘¥ ç”¨æˆ·ç®¡ç†
- æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·åˆ—è¡¨ï¼ˆæ”¯æŒåˆ†é¡µã€ç­›é€‰ï¼‰
- æŸ¥çœ‹ç”¨æˆ·è¯¦ç»†ä¿¡æ¯å’Œèµ„æ–™
- è®¾ç½®å’Œå–æ¶ˆç”¨æˆ·ç®¡ç†å‘˜æƒé™
- æŸ¥çœ‹ç”¨æˆ·è®¢å•å†å²

#### ğŸ¤ ä»£ç†ç®¡ç†  
- è®¾ç½®ç”¨æˆ·çš„ä»£ç†ç­‰çº§ï¼ˆæ™®é€šç”¨æˆ·ã€æ ¡ä»£ç†ã€åŒºä»£ç†ï¼‰
- ä¸ºæ ¡ä»£ç†åˆ†é…ç®¡ç†çš„å­¦æ ¡
- ä¸ºåŒºä»£ç†åˆ†é…ç®¡ç†çš„åŒºåŸŸ
- æŸ¥çœ‹ä»£ç†ä¸‹å±ç”¨æˆ·å’Œé”€å”®ç»Ÿè®¡

#### ğŸ›ï¸ å•†å“ç®¡ç†
- åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤å•†å“
- ç®¡ç†å•†å“ä»·æ ¼ã€åº“å­˜ã€å±æ€§
- å•†å“ä¸Šæ¶å’Œä¸‹æ¶æ§åˆ¶

### ç”¨æˆ·æƒé™ä½“ç³»
- **æ™®é€šç”¨æˆ·**: åŸºæœ¬åŠŸèƒ½è®¿é—®æƒé™
- **ä»£ç†ç”¨æˆ·**: ä»£ç†åŠŸèƒ½ + ä½£é‡‘ç®¡ç†æƒé™  
- **ç®¡ç†å‘˜ç”¨æˆ·**: å…¨éƒ¨åŠŸèƒ½ + åå°ç®¡ç†æƒé™

## APIè·¯ç”±ç«¯ç‚¹

## è·¯ç”±åˆ†ç±»

### 1. å¾®ä¿¡å°ç¨‹åºç›¸å…³è·¯ç”±

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| POST | `/sns/jscode2session` | å¾®ä¿¡ç™»å½•API | å¦ |
| POST | `/api/dev-login` | å¼€å‘ç¯å¢ƒç™»å½•ï¼ˆä»…é™å¼€å‘ï¼‰ | å¦ |

### 2. ç”¨æˆ·è®¤è¯ç›¸å…³è·¯ç”±

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| POST | `/api/auth` | ç”¨æˆ·ç™»å½• | å¦ |
| POST | `/api/auth/refresh` | åˆ·æ–°Token | æ˜¯ |

### 3. ç”¨æˆ·ç®¡ç†ç›¸å…³è·¯ç”±

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| GET | `/api/users/:user_id` | è·å–ç”¨æˆ·ä¿¡æ¯ | æ˜¯ |
| POST | `/api/users/profile` | æ›´æ–°ç”¨æˆ·èµ„æ–™ | æ˜¯ |
| GET | `/api/users/:user_id/avatar` | è·å–ç”¨æˆ·å¤´åƒ | æ˜¯ |
| POST | `/api/users/:user_id/avatar` | ä¸Šä¼ ç”¨æˆ·å¤´åƒ | æ˜¯ |
| GET | `/api/users/:user_id/qrcode` | è·å–ç”¨æˆ·æ¨èäºŒç»´ç  | æ˜¯ |
| GET | `/api/users/:user_id/addresses` | è·å–ç”¨æˆ·åœ°å€åˆ—è¡¨ | æ˜¯ |
| POST | `/api/users/:user_id/address` | åˆ›å»ºæ”¶è´§åœ°å€ | æ˜¯ |
| PUT | `/api/users/:user_id/address/:address_id` | æ›´æ–°æ”¶è´§åœ°å€ | æ˜¯ |
| DELETE | `/api/users/:user_id/address/:address_id` | åˆ é™¤æ”¶è´§åœ°å€ | æ˜¯ |

### 4. å•†åŸç›¸å…³è·¯ç”±

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| GET | `/api/products` | è·å–æ‰€æœ‰å•†å“ | å¦ |
| GET | `/api/product/:product_id` | è·å–ç‰¹å®šå•†å“è¯¦æƒ… | å¦ |
| GET | `/api/users/:user_id/cart` | è·å–ç”¨æˆ·è´­ç‰©è½¦ | æ˜¯ |
| POST | `/api/users/:user_id/cart` | æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦ | æ˜¯ |
| PUT | `/api/users/:user_id/cart/items/:product_id` | æ›´æ–°è´­ç‰©è½¦å•†å“æ•°é‡ | æ˜¯ |
| DELETE | `/api/users/:user_id/cart/items/:product_id` | åˆ é™¤è´­ç‰©è½¦å•†å“ | æ˜¯ |
| PUT | `/api/users/:user_id/cart/items/:product_id/select` | é€‰æ‹©/å–æ¶ˆé€‰æ‹©è´­ç‰©è½¦å•†å“ | æ˜¯ |
| PUT | `/api/users/:user_id/cart/select-all` | å…¨é€‰/åé€‰è´­ç‰©è½¦å•†å“ | æ˜¯ |
| GET | `/api/users/:user_id/cart/selected` | è·å–é€‰ä¸­çš„è´­ç‰©è½¦å•†å“ | æ˜¯ |
| POST | `/api/users/:user_id/orders` | ä»è´­ç‰©è½¦åˆ›å»ºè®¢å• | æ˜¯ |
| GET | `/api/users/:user_id/orders` | è·å–è®¢å•å†å² | æ˜¯ |
| GET | `/api/users/:user_id/orders/:order_id` | è·å–è®¢å•è¯¦æƒ… | æ˜¯ |
| POST | `/api/users/:user_id/direct-purchase` | ç›´æ¥è´­ä¹°å•†å“ | æ˜¯ |

### 5. å¾®ä¿¡æ”¯ä»˜ç›¸å…³è·¯ç”±

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| POST | `/api/users/:user_id/orders/pay` | åˆ›å»ºå¾®ä¿¡æ”¯ä»˜è®¢å• | æ˜¯ |
| POST | `/api/wechat/pay/notify` | å¾®ä¿¡æ”¯ä»˜å›è°ƒé€šçŸ¥ | å¦ |
| POST | `/api/users/:user_id/refunds` | ç”³è¯·é€€æ¬¾ | æ˜¯ |
| GET | `/api/users/:user_id/refunds` | è·å–é€€æ¬¾è®°å½• | æ˜¯ |
| GET | `/api/users/:user_id/refunds/:refund_id` | è·å–é€€æ¬¾è¯¦æƒ… | æ˜¯ |
| GET | `/api/users/:user_id/transfer-bills/:transfer_bill_no` | æŸ¥è¯¢å¾®ä¿¡è½¬è´¦å•è¯¦æƒ… | æ˜¯ |

### 6. å­¦ä¹ è¿›åº¦ç›¸å…³è·¯ç”±

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| GET | `/api/books` | è·å–ä¹¦ç±åˆ—è¡¨ | å¦ |
| GET | `/api/users/:user_id/progress` | è·å–ç”¨æˆ·å­¦ä¹ è¿›åº¦ | æ˜¯ |
| PUT | `/api/users/:user_id/progress` | æ›´æ–°ç”¨æˆ·å­¦ä¹ è¿›åº¦ | æ˜¯ |
| GET | `/api/books/:book_id/words` | è·å–ä¹¦ç±å•è¯ | æ˜¯ |

### 6.1. å•è¯å¡ç‰‡ç›¸å…³è·¯ç”±

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| GET | `/api/units/:unit_id/words` | æ ¹æ®å•å…ƒIDè·å–è¯¥å•å…ƒçš„æ‰€æœ‰å•è¯åˆ—è¡¨ | æ˜¯ |
| GET | `/api/words/:word_name/card` | æ ¹æ®å•è¯åç§°è·å–å•è¯å¡ç‰‡è¯¦ç»†ä¿¡æ¯ | æ˜¯ |
| GET | `/api/words/:word_id/card` | æ ¹æ®å•è¯IDè·å–å•è¯å¡ç‰‡è¯¦ç»†ä¿¡æ¯ï¼ˆåŒ…æ‹¬å›¾ç‰‡ï¼‰ | æ˜¯ |
| GET | `/api/words?unit_name=xxx&book_name=xxx` | é€šè¿‡å•å…ƒåç§°å’Œä¹¦ç±åç§°è·å–å•è¯åˆ—è¡¨ï¼ˆå¯é€‰å‚æ•°ï¼‰ | æ˜¯ |

### 6.2. æ”¶è—åŠŸèƒ½ç›¸å…³è·¯ç”±

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| GET | `/api/users/:user_id/collected-cards` | è·å–ç”¨æˆ·æ”¶è—çš„å•è¯å¡åˆ—è¡¨ | æ˜¯ |
| POST | `/api/users/:user_id/collected-cards/:word_id` | æ·»åŠ å•è¯å¡åˆ°æ”¶è—åˆ—è¡¨ | æ˜¯ |
| DELETE | `/api/users/:user_id/collected-cards/:word_id` | ä»æ”¶è—åˆ—è¡¨ä¸­ç§»é™¤å•è¯å¡ | æ˜¯ |
| GET | `/api/users/:user_id/collected-cards/:word_id/status` | æ£€æŸ¥å•è¯å¡æ˜¯å¦å·²è¢«æ”¶è— | æ˜¯ |

### 7. æœç´¢ç›¸å…³è·¯ç”±

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| POST | `/api/search` | ç»¼åˆæœç´¢ï¼ˆæ”¯æŒå•è¯ã€è¯¾æœ¬ã€è®¢å•ï¼‰ | å¦ |
| GET | `/api/search/words` | å•è¯æ¨¡ç³Šæœç´¢ | å¦ |
| GET | `/api/search/books` | è¯¾æœ¬æ¨¡ç³Šæœç´¢ | å¦ |
| GET | `/api/search/orders` | è®¢å•æœç´¢ï¼ˆæ ¹æ®å•†å“åç§°ï¼‰ | æ˜¯ |

### 8. æ¨èç³»ç»Ÿç›¸å…³è·¯ç”±

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| POST | `/api/referrals/validate` | éªŒè¯æ¨èç  | å¦ |
| GET | `/api/users/:user_id/referral` | è·å–ç”¨æˆ·æ¨èä¿¡æ¯ | æ˜¯ |
| POST | `/api/referrals` | è·Ÿè¸ªæ¨èå…³ç³» | æ˜¯ |
| GET | `/api/users/:user_id/referral/commissions` | æŸ¥çœ‹è¿”ç°è®°å½• | æ˜¯ |
| POST | `/api/wxacode/unlimited` | ç”Ÿæˆä¸é™åˆ¶å°ç¨‹åºç  | æ˜¯ |

### 9. ä»£ç†ç³»ç»Ÿç›¸å…³è·¯ç”±

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| GET | `/api/agents/:user_id/users` | åˆ—å‡ºä»£ç†ç®¡ç†çš„ç”¨æˆ· | æ˜¯ |
| GET | `/api/agents/:user_id/sales` | åˆ—å‡ºæ‰€æœ‰ä»£ç†é”€å”®æ•°æ®å’Œä½£é‡‘ | æ˜¯ |
| POST | `/api/agents/:user_id/withdraw` | æå–ä½£é‡‘ | æ˜¯ |
| GET | `/api/agents/:user_id/commission/dashboard` | è·å–ä»£ç†ä½£é‡‘ä»ªè¡¨æ¿ | æ˜¯ |
| GET | `/api/agents/:user_id/commission/details` | è·å–ä»£ç†ä½£é‡‘æ˜ç»† | æ˜¯ |

### 10. ğŸ¯ ç®¡ç†å‘˜åå°ç›¸å…³è·¯ç”± (é‡ç‚¹å¼€å‘)

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ | åŠŸèƒ½æ¨¡å— |
|------|------|------|------|----------|
| GET | `/api/admin/users` | è·å–æ‰€æœ‰ç”¨æˆ·åˆ—è¡¨ï¼ˆæ”¯æŒåˆ†é¡µã€ç­›é€‰ï¼‰ | æ˜¯ï¼ˆç®¡ç†å‘˜ï¼‰ | ğŸ‘¥ ç”¨æˆ·ç®¡ç† |
| GET | `/api/admin/users/:user_id` | è·å–ç”¨æˆ·è¯¦ç»†ä¿¡æ¯ | æ˜¯ï¼ˆç®¡ç†å‘˜ï¼‰ | ğŸ‘¥ ç”¨æˆ·ç®¡ç† |
| PUT | `/api/admin/users/:user_id/admin` | è®¾ç½®/å–æ¶ˆç”¨æˆ·ç®¡ç†å‘˜æƒé™ | æ˜¯ï¼ˆç®¡ç†å‘˜ï¼‰ | ğŸ‘¥ ç”¨æˆ·ç®¡ç† |
| GET | `/api/admin/users/:user_id/orders` | è·å–ç”¨æˆ·è®¢å•åˆ—è¡¨ | æ˜¯ï¼ˆç®¡ç†å‘˜ï¼‰ | ğŸ‘¥ ç”¨æˆ·ç®¡ç† |
| PUT | `/api/admin/users/:user_id/agent-level` | æ›´æ–°ç”¨æˆ·ä»£ç†ç­‰çº§ | æ˜¯ï¼ˆç®¡ç†å‘˜ï¼‰ | ğŸ¤ ä»£ç†ç®¡ç† |
| PUT | `/api/admin/agents/:user_id/schools` | è®¾ç½®æ ¡ä»£ç†ç®¡ç†çš„å­¦æ ¡ | æ˜¯ï¼ˆç®¡ç†å‘˜ï¼‰ | ğŸ¤ ä»£ç†ç®¡ç† |
| PUT | `/api/admin/agents/:user_id/regions` | è®¾ç½®åŒºä»£ç†ç®¡ç†çš„åŒºåŸŸ | æ˜¯ï¼ˆç®¡ç†å‘˜ï¼‰ | ğŸ¤ ä»£ç†ç®¡ç† |
| GET | `/api/admin/agents/:user_id/stats` | è·å–ä»£ç†ç»Ÿè®¡ä¿¡æ¯ | æ˜¯ï¼ˆç®¡ç†å‘˜ï¼‰ | ğŸ¤ ä»£ç†ç®¡ç† |
| POST | `/api/admin/products` | åˆ›å»ºå•†å“ | æ˜¯ï¼ˆç®¡ç†å‘˜ï¼‰ | ğŸ›ï¸ å•†å“ç®¡ç† |
| PUT | `/api/admin/products/:product_id` | æ›´æ–°å•†å“ä¿¡æ¯ | æ˜¯ï¼ˆç®¡ç†å‘˜ï¼‰ | ğŸ›ï¸ å•†å“ç®¡ç† |
| DELETE | `/api/admin/products/:product_id` | åˆ é™¤å•†å“ | æ˜¯ï¼ˆç®¡ç†å‘˜ï¼‰ | ğŸ›ï¸ å•†å“ç®¡ç† |
| PUT | `/api/admin/products/:product_id/status` | æ›´æ–°å•†å“ä¸Šä¸‹æ¶çŠ¶æ€ | æ˜¯ï¼ˆç®¡ç†å‘˜ï¼‰ | ğŸ›ï¸ å•†å“ç®¡ç† |

> **æ³¨æ„**: ç®¡ç†å‘˜åå°APIæ˜¯å‰ç«¯Webç®¡ç†ç•Œé¢çš„æ ¸å¿ƒï¼Œéœ€è¦ç‰¹åˆ«å…³æ³¨è¿™äº›æ¥å£çš„å¯¹æ¥å’Œæµ‹è¯•ã€‚

### 11. ç³»ç»Ÿè·¯ç”±

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| GET | `/health` | å¥åº·æ£€æŸ¥ | å¦ |

## ğŸ—ï¸ é¡¹ç›®æ¶æ„è¯´æ˜

### æ§åˆ¶å™¨æ–‡ä»¶è¯´æ˜
- `auth_controller.go` - ç”¨æˆ·è®¤è¯ç›¸å…³å¤„ç†å™¨
- `user_controller.go` - ç”¨æˆ·ç®¡ç†ç›¸å…³å¤„ç†å™¨  
- `store_controller.go` - å•†åŸç›¸å…³å¤„ç†å™¨
- `progress_controller.go` - å­¦ä¹ è¿›åº¦ç›¸å…³å¤„ç†å™¨
- `card_controller.go` - å•è¯å¡ç‰‡ç›¸å…³å¤„ç†å™¨
- `search_controller.go` - æœç´¢åŠŸèƒ½ç›¸å…³å¤„ç†å™¨
- `referral_controller.go` - æ¨èç³»ç»Ÿç›¸å…³å¤„ç†å™¨
- `agent_controller.go` - ä»£ç†ç³»ç»Ÿç›¸å…³å¤„ç†å™¨
- **`admin_controller.go` - ğŸ¯ ç®¡ç†å‘˜åå°ç›¸å…³å¤„ç†å™¨ï¼ˆé‡ç‚¹æ–‡ä»¶ï¼‰**

### ä¸­é—´ä»¶è¯´æ˜
- `middlewares/token_handler.go` - JWT Tokenè®¤è¯ä¸­é—´ä»¶
- **`middlewares/admin_middleware.go` - ğŸ¯ ç®¡ç†å‘˜æƒé™éªŒè¯ä¸­é—´ä»¶ï¼ˆé‡ç‚¹æ–‡ä»¶ï¼‰**
- `middlewares/error_handler.go` - ç»Ÿä¸€é”™è¯¯å¤„ç†ä¸­é—´ä»¶

### æ•°æ®æ¨¡å‹è¯´æ˜
- `models/common.go` - æ‰€æœ‰æ•°æ®ç»“æ„ä½“å®šä¹‰
- `models/å¾®ä¿¡å°ç¨‹åº.openapi.json` - å®Œæ•´çš„APIæ–‡æ¡£

## ğŸ“ æ ¸å¿ƒæ•°æ®æ¨¡å‹

### ç”¨æˆ·æ¨¡å‹ (User)
```json
{
  "_id": "string",
  "openID": "string",           // å¾®ä¿¡openIDï¼Œä½œä¸ºä¸»è¦æ ‡è¯†
  "user_name": "string",
  "school": "string",
  "age": 20,
  "agent_level": 0,            // 0:æ™®é€šç”¨æˆ·, 1:æ ¡ä»£ç†, 2:åŒºä»£ç†
  "is_admin": false,           // ğŸ¯ ç®¡ç†å‘˜æ ‡è¯†ï¼ˆé‡è¦å­—æ®µï¼‰
  "is_agent": false,
  "managed_schools": [],       // æ ¡ä»£ç†ç®¡ç†çš„å­¦æ ¡
  "managed_regions": [],       // åŒºä»£ç†ç®¡ç†çš„åŒºåŸŸ
  "created_at": "2024-01-01T00:00:00Z",
  "updated_at": "2024-01-01T00:00:00Z"
}
```

### å•†å“æ¨¡å‹ (Product)
```json
{
  "_id": "string",
  "product_id": "string",
  "name": "string",
  "price": 99.99,
  "description": "string",
  "stock": 100,
  "product_type": "physical|digital",
  "is_active": true,           // ğŸ¯ ä¸Šä¸‹æ¶çŠ¶æ€ï¼ˆç®¡ç†å‘˜å¯æ§åˆ¶ï¼‰
  "images": ["url1", "url2"],
  "created_at": "2024-01-01T00:00:00Z",
  "updated_at": "2024-01-01T00:00:00Z"
}
```

### è®¢å•æ¨¡å‹ (Order)
```json
{
  "_id": "string", 
  "user_openid": "string",
  "items": [{"product_id": "string", "quantity": 1, "price": 99.99}],
  "total_amount": 99.99,
  "status": "pending|paid|shipped|delivered|cancelled",
  "created_at": "2024-01-01T00:00:00Z",
  "updated_at": "2024-01-01T00:00:00Z"
}
```

## ğŸ” è®¤è¯ä¸æƒé™

### JWT Token ä½¿ç”¨
```http
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### æƒé™ç­‰çº§
1. **æ— è®¤è¯**: å…¬å¼€APIï¼ˆå¦‚è·å–å•†å“åˆ—è¡¨ï¼‰
2. **ç”¨æˆ·è®¤è¯**: éœ€è¦æœ‰æ•ˆJWT Token
3. **ğŸ¯ ç®¡ç†å‘˜è®¤è¯**: éœ€è¦JWT Token + `is_admin=true`

### ç®¡ç†å‘˜æƒé™éªŒè¯æµç¨‹
1. JWT Tokenè®¤è¯ â†’ 2. è·å–ç”¨æˆ·ä¿¡æ¯ â†’ 3. æ£€æŸ¥ `is_admin` å­—æ®µ â†’ 4. é€šè¿‡/æ‹’ç»

## ğŸ“¡ APIå“åº”æ ¼å¼

### æˆåŠŸå“åº”
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    // å…·ä½“æ•°æ®å†…å®¹
  }
}
```

### é”™è¯¯å“åº”
```json
{
  "code": 400,
  "message": "è¯·æ±‚å‚æ•°é”™è¯¯",
  "error": "VALIDATION_ERROR"
}
```

### åˆ†é¡µå“åº”
```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "items": [],
    "pagination": {
      "page": 1,
      "limit": 20,
      "total": 100,
      "total_pages": 5
    }
  }
}
```

## âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹

### è®¤è¯ç›¸å…³
1. æ‰€æœ‰å¸¦æœ‰"æ˜¯"è®¤è¯æ ‡è®°çš„è·¯ç”±éƒ½éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­åŒ…å«æœ‰æ•ˆçš„JWT Token
2. **ğŸ¯ æ‰€æœ‰å¸¦æœ‰"æ˜¯ï¼ˆç®¡ç†å‘˜ï¼‰"è®¤è¯æ ‡è®°çš„è·¯ç”±éœ€è¦JWT Tokenä¸”ç”¨æˆ·å…·å¤‡ç®¡ç†å‘˜æƒé™ï¼ˆis_admin=trueï¼‰**
3. JWT Tokenæ ¼å¼ï¼š`Authorization: Bearer <token>`
4. Tokenè¿‡æœŸæ—¶éœ€è¦ä½¿ç”¨refreshæ¥å£åˆ·æ–°

### ç®¡ç†å‘˜åå°ç‰¹æ®Šè¯´æ˜
5. **ğŸ¯ ç®¡ç†å‘˜åå°APIç»Ÿä¸€ä½¿ç”¨`/api/admin`å‰ç¼€**
6. **ğŸ¯ æ‰€æœ‰adminè·¯ç”±éƒ½é€šè¿‡AdminAuthMiddlewareè¿›è¡Œæƒé™éªŒè¯**
7. **ğŸ¯ å‰ç«¯éœ€è¦å…ˆæ£€æŸ¥ç”¨æˆ·çš„`is_admin`å­—æ®µï¼Œåªæœ‰ç®¡ç†å‘˜æ‰èƒ½è®¿é—®åå°ç•Œé¢**

### æ•°æ®å¤„ç†
8. æ‰€æœ‰å“åº”æ ¼å¼ç»Ÿä¸€ä¸ºJSONï¼ŒåŒ…å«codeã€messageå’Œdataå­—æ®µ
9. ç”¨æˆ·æ ‡è¯†ç»Ÿä¸€ä½¿ç”¨openIDï¼Œç¦æ­¢ä½¿ç”¨MongoDBçš„_idä½œä¸ºä¸šåŠ¡æ ‡è¯†
10. æ—¶é—´æ ¼å¼ç»Ÿä¸€ä½¿ç”¨UTCæ—¶é—´ï¼š`2024-01-01T00:00:00Z`

### é”™è¯¯å¤„ç†
11. ç»Ÿä¸€é”™è¯¯ä»£ç ä½“ç³»ï¼ˆè¯¦è§ä¸‹æ–¹é”™è¯¯ä»£ç è¡¨ï¼‰
12. æ‰€æœ‰å¼‚å¸¸éƒ½ä¼šè¢«error_handlerä¸­é—´ä»¶æ•è·å¹¶ç»Ÿä¸€å¤„ç†

## ğŸ“Š é”™è¯¯ä»£ç è¡¨

| ä»£ç  | å«ä¹‰ | å¸¸è§åœºæ™¯ |
|------|------|----------|
| 200 | æˆåŠŸ | è¯·æ±‚å¤„ç†æˆåŠŸ |
| 201 | åˆ›å»ºæˆåŠŸ | èµ„æºåˆ›å»ºæˆåŠŸ |
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ | å‚æ•°ç¼ºå¤±ã€æ ¼å¼é”™è¯¯ |
| 401 | æœªæˆæƒ | Tokenæ— æ•ˆã€Tokenè¿‡æœŸ |
| 403 | æ— æƒé™ | **ğŸ¯ éç®¡ç†å‘˜è®¿é—®adminæ¥å£** |
| 404 | èµ„æºä¸å­˜åœ¨ | ç”¨æˆ·ã€å•†å“ã€è®¢å•ä¸å­˜åœ¨ |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ | æ•°æ®åº“è¿æ¥å¤±è´¥ã€ç³»ç»Ÿå¼‚å¸¸ |

## ğŸ”¥ ç®¡ç†å‘˜åå°APIç¤ºä¾‹

### è·å–ç”¨æˆ·åˆ—è¡¨
```http
GET /api/admin/users?page=1&limit=20&agent_level=1
Authorization: Bearer <admin_token>
```

**å“åº”**:
```json
{
  "code": 200,
  "message": "è·å–ç”¨æˆ·åˆ—è¡¨æˆåŠŸ",
  "data": {
    "users": [
      {
        "_id": "507f1f77bcf86cd799439011",
        "openID": "oGZUI0egBJY1zhBY2E5hrWOjn_fs",
        "user_name": "å¼ ä¸‰",
        "school": "åŒ—äº¬å¤§å­¦",
        "agent_level": 1,
        "is_admin": false,
        "is_agent": true,
        "created_at": "2024-01-01T00:00:00Z"
      }
    ],
    "pagination": {
      "page": 1,
      "limit": 20,
      "total": 100,
      "total_pages": 5
    }
  }
}
```

### è®¾ç½®ç”¨æˆ·ç®¡ç†å‘˜æƒé™
```http
PUT /api/admin/users/oGZUI0egBJY1zhBY2E5hrWOjn_fs/admin
Authorization: Bearer <admin_token>
Content-Type: application/json

{
  "is_admin": true
}
```

### åˆ›å»ºå•†å“
```http
POST /api/admin/products
Authorization: Bearer <admin_token>
Content-Type: application/json

{
  "name": "è‹±è¯­å­¦ä¹ å¡ç‰‡å¥—è£…",
  "price": 99.99,
  "description": "åŒ…å«1000ä¸ªæ ¸å¿ƒå•è¯",
  "stock": 100,
  "product_type": "physical",
  "images": ["https://example.com/image1.jpg"]
}
```

## ğŸš€ å‰ç«¯å¼€å‘æŒ‡å—

### ç¯å¢ƒé…ç½®
```javascript
// é…ç½®APIåŸºç¡€URL
const API_BASE_URL = 'http://localhost:8080/api'
const ADMIN_API_BASE_URL = 'http://localhost:8080/api/admin'

// å¼€å‘ç¯å¢ƒç™»å½•ï¼ˆä»…é™å¼€å‘ï¼‰
const DEV_LOGIN_URL = 'http://localhost:8080/api/dev-login'
```

### æƒé™éªŒè¯æµç¨‹
```javascript
// 1. ç™»å½•è·å–Token
async function login(openid) {
  const response = await fetch(`${API_BASE_URL}/dev-login`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ openid })
  })
  const data = await response.json()
  
  // ä¿å­˜Tokenå’Œç”¨æˆ·ä¿¡æ¯
  localStorage.setItem('token', data.data.token)
  localStorage.setItem('user', JSON.stringify(data.data.user))
  
  return data.data.user
}

// 2. æ£€æŸ¥ç®¡ç†å‘˜æƒé™
function isAdmin() {
  const user = JSON.parse(localStorage.getItem('user') || '{}')
  return user.is_admin === true
}

// 3. ç®¡ç†å‘˜è·¯ç”±å®ˆå«
function requireAdmin() {
  if (!isAdmin()) {
    alert('éœ€è¦ç®¡ç†å‘˜æƒé™æ‰èƒ½è®¿é—®æ­¤é¡µé¢')
    window.location.href = '/login'
    return false
  }
  return true
}
```

### APIè¯·æ±‚å°è£…
```javascript
// é€šç”¨APIè¯·æ±‚å‡½æ•°
async function apiRequest(url, options = {}) {
  const token = localStorage.getItem('token')
  
  const config = {
    ...options,
    headers: {
      'Content-Type': 'application/json',
      ...(token && { 'Authorization': `Bearer ${token}` }),
      ...options.headers,
    },
  }
  
  const response = await fetch(url, config)
  const data = await response.json()
  
  // ç»Ÿä¸€é”™è¯¯å¤„ç†
  if (data.code !== 200 && data.code !== 201) {
    if (data.code === 401) {
      // Tokenè¿‡æœŸï¼Œè·³è½¬ç™»å½•
      localStorage.removeItem('token')
      window.location.href = '/login'
    } else if (data.code === 403) {
      // æƒé™ä¸è¶³
      alert('æƒé™ä¸è¶³ï¼š' + data.message)
    } else {
      // å…¶ä»–é”™è¯¯
      alert('é”™è¯¯ï¼š' + data.message)
    }
    throw new Error(data.message)
  }
  
  return data
}

// ç®¡ç†å‘˜APIä¸“ç”¨å‡½æ•°
async function adminApiRequest(endpoint, options = {}) {
  if (!requireAdmin()) return null
  
  return await apiRequest(`${ADMIN_API_BASE_URL}${endpoint}`, options)
}
```

### æ ¸å¿ƒç®¡ç†åŠŸèƒ½ç¤ºä¾‹
```javascript
// è·å–ç”¨æˆ·åˆ—è¡¨
async function getUserList(page = 1, limit = 20, filters = {}) {
  const params = new URLSearchParams({
    page: page.toString(),
    limit: limit.toString(),
    ...filters
  })
  
  return await adminApiRequest(`/users?${params}`)
}

// æ›´æ–°ç”¨æˆ·ç®¡ç†å‘˜æƒé™
async function updateUserAdminStatus(userId, isAdmin) {
  return await adminApiRequest(`/users/${userId}/admin`, {
    method: 'PUT',
    body: JSON.stringify({ is_admin: isAdmin })
  })
}

// åˆ›å»ºå•†å“
async function createProduct(productData) {
  return await adminApiRequest('/products', {
    method: 'POST',
    body: JSON.stringify(productData)
  })
}
```

## ğŸ¯ ç®¡ç†å‘˜åå°å¼€å‘é‡ç‚¹

### å¿…é¡»å®ç°çš„é¡µé¢
1. **ğŸ  ä»ªè¡¨æ¿** - ç³»ç»Ÿæ¦‚è§ˆã€ç»Ÿè®¡æ•°æ®
2. **ğŸ‘¥ ç”¨æˆ·ç®¡ç†** - ç”¨æˆ·åˆ—è¡¨ã€è¯¦æƒ…ã€æƒé™è®¾ç½®
3. **ğŸ¤ ä»£ç†ç®¡ç†** - ä»£ç†ç­‰çº§è®¾ç½®ã€åŒºåŸŸåˆ†é…ã€ç»Ÿè®¡æŸ¥çœ‹
4. **ğŸ›ï¸ å•†å“ç®¡ç†** - å•†å“CRUDã€ä¸Šä¸‹æ¶æ§åˆ¶
5. **ğŸ“Š è®¢å•ç®¡ç†** - è®¢å•æŸ¥çœ‹ã€çŠ¶æ€ç®¡ç†ã€é€€æ¬¾å®¡æ ¸
6. **ğŸ“š å†…å®¹ç®¡ç†** - ä¹¦ç±å’Œå•è¯ç®¡ç†ï¼ˆå¾…å¼€å‘ï¼‰

### æŠ€æœ¯å»ºè®®
- **å‰ç«¯æ¡†æ¶**: React/Vue.js + Ant Design/Element UI
- **çŠ¶æ€ç®¡ç†**: Redux/Vuex + æŒä¹…åŒ–å­˜å‚¨
- **è·¯ç”±å®ˆå«**: åŸºäº`is_admin`å­—æ®µçš„æƒé™æ§åˆ¶
- **APIç®¡ç†**: Axios + ç»Ÿä¸€é”™è¯¯å¤„ç†
- **è¡¨æ ¼ç»„ä»¶**: æ”¯æŒåˆ†é¡µã€ç­›é€‰ã€æ’åºçš„æ•°æ®è¡¨æ ¼

## ğŸ“‹ ä¸‹ä¸€æ­¥å¼€å‘è®¡åˆ’

### åç«¯ä»»åŠ¡
1. âœ… å®ç°æ•°æ®åº“æ¨¡å‹å’Œè¿æ¥
2. âœ… å®Œæˆå¾®ä¿¡å°ç¨‹åºç™»å½•é€»è¾‘
3. âœ… å®ç°JWT Tokenç”Ÿæˆå’ŒéªŒè¯
4. âœ… å®ç°ç®¡ç†å‘˜æƒé™éªŒè¯ä¸­é—´ä»¶
5. âœ… å®Œæˆç”¨æˆ·ç®¡ç†ã€ä»£ç†ç®¡ç†ã€å•†å“ç®¡ç†API
6. ğŸ”² å®Œæˆè®¢å•ç®¡ç†APIï¼ˆå®¡æ ¸é€€æ¬¾ç­‰ï¼‰
7. ğŸ”² å®Œæˆä¹¦ç±å’Œå•è¯ç®¡ç†API
8. ğŸ”² æ·»åŠ å•å…ƒæµ‹è¯•

### å‰ç«¯ä»»åŠ¡  
1. ğŸ”² **ğŸ¯ æ­å»ºç®¡ç†å‘˜åå°Webç•Œé¢**
2. ğŸ”² **ğŸ¯ å®ç°ç”¨æˆ·ç®¡ç†é¡µé¢**
3. ğŸ”² **ğŸ¯ å®ç°ä»£ç†ç®¡ç†é¡µé¢**
4. ğŸ”² **ğŸ¯ å®ç°å•†å“ç®¡ç†é¡µé¢**
5. ğŸ”² å®ç°ç™»å½•å’Œæƒé™éªŒè¯
6. ğŸ”² å®ç°ç»Ÿä¸€çš„APIè°ƒç”¨å°è£…
7. ğŸ”² å®Œå–„é”™è¯¯å¤„ç†å’Œç”¨æˆ·ä½“éªŒ

> **ğŸš¨ é‡è¦æç¤º**: ç®¡ç†å‘˜åå°çš„å‰ç«¯å¼€å‘åº”è¯¥ä¼˜å…ˆå…³æ³¨ç¬¬10èŠ‚åˆ—å‡ºçš„admin APIï¼Œè¿™äº›æ˜¯æ ¸å¿ƒç®¡ç†åŠŸèƒ½ï¼Œå·²å®Œå…¨å®ç°å¹¶å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚