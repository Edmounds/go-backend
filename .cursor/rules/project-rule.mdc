---
alwaysApply: true
---

- **错误处理统一**：所有控制器仅使用 `controllers/common.go` 提供的统一响应封装；异常交由 `middlewares/error_handler.go` 的错误处理中间件处理；禁止手写零散 JSON 响应。
- **模型来源唯一**：所有数据结构体一律从 `models/common.go` 引用，禁止在控制器/服务中自建或重复定义结构体（写代码先在 `models/common.go` 查找/复用）。
- **用户标识唯一**：前端传参名 `user_id` 视为用户的 openid 使用[[memory:6131446]]；数据库层唯一标识为 openid，外键字段统一为 `user_openid`，禁止在业务与查询中过滤或依赖 MongoDB `_id`[[memory:6131439]]。
- **数据库上下文统一**：仅通过 `CreateDBContext()` 获取数据库上下文；禁止重复创建连接或新增数据库控制器；已移除的 `controllers/database_controller.go` 不得再出现等价实现。
- **响应格式一致**：新旧接口均必须使用 `controllers/common.go` 中的标准响应函数与 HTTP 状态码约定，保持 API 返回体结构一致、可预测。
- **路由与数据结构稳定**：不得修改既有路由签名与数据库结构；仅在字段引用方式上坚持 openid 规范，保证向后兼容。

- **代码质量约束**：提交前确保无 lint 错误与未使用导入；尽量复用公共方法，禁止引入重复/冗余代码。

