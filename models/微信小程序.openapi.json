{
  "openapi": "3.0.1",
  "info": {
    "title": "微信小程序",
    "description": "",
    "version": "1.0.0"
  },
  "tags": [
    {
      "name": "User"
    },
    {
      "name": "Referrals"
    },
    {
      "name": "Agent"
    },
    {
      "name": "Search"
    },
    {
      "name": "Payment"
    },
    {
      "name": "Cards"
    },
    {
      "name": "System"
    },
    {
      "name": "Store"
    },
    {
      "name": "Progress"
    },
    {
      "name": "Auth"
    }
  ],
  "paths": {
    "/api/auth/refresh": {
      "post": {
        "summary": "刷新Token",
        "deprecated": false,
        "description": "刷新JWT Token",
        "operationId": "post_auth_refresh",
        "tags": [
          "User",
          "Auth"
        ],
        "parameters": [],
        "responses": {
          "200": {
            "description": "Token刷新成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "integer"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "token": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "token"
                      ]
                    },
                    "message": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "code",
                    "data",
                    "message"
                  ]
                },
                "example": {
                  "code": 200,
                  "data": {
                    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJVc2VyTmFtZSI6IiIsIlVzZXJJZCI6Im9qbVU4NVgyUzBkTXlBM1hVWkpuQjNDWHU2XzgiLCJpc3MiOiJtaW5pcHJvZ3JhbSIsImV4cCI6MTc1NTM2MTg2OSwibmJmIjoxNzU1Mjc1NDY5LCJpYXQiOjE3NTUyNzU0Njl9.NPguGMgHsnP9WKa67JvfRCax3WuNJlYjkSjf14KZjbA"
                  },
                  "message": "Token刷新成功"
                }
              }
            },
            "headers": {}
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/dev-login": {
      "post": {
        "summary": "开发环境登录",
        "deprecated": false,
        "description": "仅限开发环境使用，通过openid直接获取JWT Token，用于测试其他需要认证的接口",
        "operationId": "post_dev-login",
        "tags": [
          "User",
          "Auth"
        ],
        "parameters": [],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "openid"
                ],
                "properties": {
                  "openid": {
                    "type": "string",
                    "description": "用户的openid",
                    "example": "oGZUI0egBJY1zhBY2E5hrWOjn_fs"
                  },
                  "referral_code": {
                    "type": "string",
                    "description": "可选的推荐码参数",
                    "example": "ABC123"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "开发环境登录成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/LoginResponse"
                },
                "example": {
                  "code": 200,
                  "message": "开发环境登录成功",
                  "data": {
                    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJVc2VyTmFtZSI6IiIsIlVzZXJJZCI6Im9qbVU4NVgyUzBkTXlBM1hVWkpuQjNDWHU2XzgiLCJpc3MiOiJtaW5pcHJvZ3JhbSIsImV4cCI6MTc1NTM2MTA2OSwibmJmIjoxNzU1Mjc0NjY5LCJpYXQiOjE3NTUyNzQ2Njl9.9LT4HPTpWfbjr4VerpXylIgLvdl9J1pbm76IrwoRNwM",
                    "user": {
                      "_id": "689cc74b1a93312980e19fef",
                      "openID": "ojmU85X2S0dMyA3XUZJnB3CXu6_8",
                      "user_name": "",
                      "class": "",
                      "age": 0,
                      "school": "",
                      "phone": "",
                      "city": "",
                      "agent_level": 2,
                      "referral_code": "ff7a8b6f",
                      "referred_by": "fb5f3646",
                      "collected_cards": [],
                      "addresses": [],
                      "progress": {
                        "current_unit": "6",
                        "learned_words": [
                          "jhjkhjk"
                        ]
                      },
                      "is_agent": true,
                      "agent_type": "",
                      "managed_schools": [],
                      "managed_regions": [],
                      "created_at": "2025-08-13T17:11:39.319Z",
                      "updated_at": "2025-08-13T21:32:13.99Z"
                    }
                  }
                }
              }
            },
            "headers": {}
          },
          "400": {
            "description": "请求参数错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "headers": {}
          },
          "403": {
            "description": "仅开发环境可用",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "code": 403,
                  "message": "此接口仅在开发环境可用",
                  "error": "forbidden"
                }
              }
            },
            "headers": {}
          },
          "500": {
            "description": "服务器内部错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": []
      }
    },
    "/api/auth": {
      "post": {
        "summary": "用户登录",
        "deprecated": false,
        "description": "用户使用微信code进行登录，成功后返回JWT Token",
        "operationId": "post_auth",
        "tags": [
          "User",
          "Auth"
        ],
        "parameters": [],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "code"
                ],
                "properties": {
                  "code": {
                    "type": "string",
                    "description": "微信登录code",
                    "example": "061Fmll0143S8X1EMGo0167W4q3Fmllf"
                  },
                  "referral_code": {
                    "type": "string",
                    "description": "可选的推荐码参数，用于扫码进入的场景",
                    "example": "ABC123"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "登录成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/LoginResponse"
                },
                "example": {
                  "code": 200,
                  "message": "登录成功",
                  "data": {
                    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
                    "user": {
                      "_id": "507f1f77bcf86cd799439011",
                      "openID": "oGZUI0egBJY1zhBY2E5hrWOjn_fs",
                      "user_name": "john_doe",
                      "school": "北京大学",
                      "age": 20,
                      "agent_level": 0,
                      "referral_code": "JOHN123"
                    }
                  }
                }
              }
            },
            "headers": {}
          },
          "400": {
            "description": "请求参数错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "headers": {}
          },
          "401": {
            "description": "认证失败",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": []
      }
    },
    "/api/users/{user_id}": {
      "get": {
        "summary": "获取用户信息",
        "deprecated": false,
        "description": "获取用户详细信息",
        "operationId": "get_users_user_id",
        "tags": [
          "User"
        ],
        "parameters": [
          {
            "name": "user_id",
            "in": "path",
            "description": "用户ID（openID）",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "获取用户信息成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserResponse"
                }
              }
            },
            "headers": {}
          },
          "404": {
            "description": "用户不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/users/{user_id}/address": {
      "post": {
        "summary": "创建收货地址",
        "deprecated": false,
        "description": "为用户创建新的收货地址",
        "tags": [
          "User"
        ],
        "parameters": [
          {
            "name": "user_id",
            "in": "path",
            "description": "用户ID",
            "required": true,
            "example": "507f1f77bcf86cd799439011",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "recipient_name",
                  "phone",
                  "province",
                  "city",
                  "street"
                ],
                "properties": {
                  "recipient_name": {
                    "type": "string",
                    "description": "收件人姓名",
                    "example": "张三"
                  },
                  "phone": {
                    "type": "string",
                    "description": "收件人电话",
                    "example": "13800138001"
                  },
                  "province": {
                    "type": "string",
                    "description": "省份",
                    "example": "北京市"
                  },
                  "city": {
                    "type": "string",
                    "description": "城市",
                    "example": "北京市"
                  },
                  "district": {
                    "type": "string",
                    "description": "区县",
                    "example": "海淀区"
                  },
                  "street": {
                    "type": "string",
                    "description": "详细地址",
                    "example": "中关村大街1号"
                  },
                  "postal_code": {
                    "type": "string",
                    "description": "邮政编码",
                    "example": "100000"
                  },
                  "is_default": {
                    "type": "boolean",
                    "description": "是否为默认地址",
                    "example": true
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "地址创建成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AddressResponse"
                },
                "example": {
                  "code": 201,
                  "message": "地址创建成功",
                  "data": {
                    "_id": "507f1f77bcf86cd799439013",
                    "recipient_name": "张三",
                    "phone": "13800138001",
                    "province": "北京市",
                    "city": "北京市",
                    "district": "海淀区",
                    "street": "中关村大街1号",
                    "postal_code": "100000",
                    "is_default": true
                  }
                }
              }
            },
            "headers": {}
          },
          "400": {
            "description": "请求参数错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "code": 400,
                  "message": "请求参数错误",
                  "error": "收件人姓名和电话不能为空"
                }
              }
            },
            "headers": {}
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "code": 401,
                  "message": "未授权",
                  "error": "请提供有效的访问令牌"
                }
              }
            },
            "headers": {}
          },
          "404": {
            "description": "用户不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "code": 404,
                  "message": "用户不存在",
                  "error": "未找到ID为 507f1f77bcf86cd799439011 的用户"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/users/{user_id}/address/{address_id}": {
      "delete": {
        "summary": "删除收货地址",
        "deprecated": false,
        "description": "删除用户的指定收货地址",
        "tags": [
          "User"
        ],
        "parameters": [
          {
            "name": "user_id",
            "in": "path",
            "description": "用户ID",
            "required": true,
            "example": "507f1f77bcf86cd799439011",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "address_id",
            "in": "path",
            "description": "地址ID",
            "required": true,
            "example": "507f1f77bcf86cd799439013",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "地址删除成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            },
            "headers": {}
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "headers": {}
          },
          "404": {
            "description": "地址不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      },
      "put": {
        "summary": "更新收货地址",
        "deprecated": false,
        "description": "更新用户的指定收货地址信息",
        "tags": [
          "User"
        ],
        "parameters": [
          {
            "name": "user_id",
            "in": "path",
            "description": "用户ID",
            "required": true,
            "example": "507f1f77bcf86cd799439011",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "address_id",
            "in": "path",
            "description": "地址ID",
            "required": true,
            "example": "507f1f77bcf86cd799439013",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "recipient_name",
                  "phone",
                  "province",
                  "city",
                  "street"
                ],
                "properties": {
                  "recipient_name": {
                    "type": "string",
                    "description": "收件人姓名",
                    "example": "李四"
                  },
                  "phone": {
                    "type": "string",
                    "description": "收件人电话",
                    "example": "13800138002"
                  },
                  "province": {
                    "type": "string",
                    "description": "省份",
                    "example": "上海市"
                  },
                  "city": {
                    "type": "string",
                    "description": "城市",
                    "example": "上海市"
                  },
                  "district": {
                    "type": "string",
                    "description": "区县",
                    "example": "浦东新区"
                  },
                  "street": {
                    "type": "string",
                    "description": "详细地址",
                    "example": "陆家嘴环路1000号"
                  },
                  "postal_code": {
                    "type": "string",
                    "description": "邮政编码",
                    "example": "200000"
                  },
                  "is_default": {
                    "type": "boolean",
                    "description": "是否为默认地址",
                    "example": false
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "地址更新成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AddressResponse"
                },
                "example": {
                  "code": 200,
                  "message": "地址更新成功",
                  "data": {
                    "_id": "507f1f77bcf86cd799439013",
                    "recipient_name": "李四",
                    "phone": "13800138002",
                    "province": "上海市",
                    "city": "上海市",
                    "district": "浦东新区",
                    "street": "陆家嘴环路1000号",
                    "postal_code": "200000",
                    "is_default": false
                  }
                }
              }
            },
            "headers": {}
          },
          "400": {
            "description": "请求参数错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "code": 400,
                  "message": "请求参数错误",
                  "error": "收件人姓名和电话不能为空"
                }
              }
            },
            "headers": {}
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "code": 401,
                  "message": "未授权",
                  "error": "请提供有效的访问令牌"
                }
              }
            },
            "headers": {}
          },
          "404": {
            "description": "地址不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "code": 404,
                  "message": "地址不存在",
                  "error": "未找到ID为 507f1f77bcf86cd799439013 的地址"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/users/{user_id}/collected-cards/{word_id}": {
      "post": {
        "summary": "收藏单词卡",
        "deprecated": false,
        "description": "将指定单词卡添加到用户收藏列表",
        "tags": [
          "User",
          "Cards"
        ],
        "parameters": [
          {
            "name": "user_id",
            "in": "path",
            "description": "用户ID（openID）",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "word_id",
            "in": "path",
            "description": "单词ID",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "收藏成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      },
      "delete": {
        "summary": "取消收藏单词卡",
        "deprecated": false,
        "description": "从用户收藏列表中移除指定单词卡",
        "tags": [
          "User",
          "Cards"
        ],
        "parameters": [
          {
            "name": "user_id",
            "in": "path",
            "description": "用户ID（openID）",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "word_id",
            "in": "path",
            "description": "单词ID",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "取消收藏成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/users/{user_id}/collected-cards": {
      "get": {
        "summary": "获取用户收藏的单词卡列表",
        "deprecated": false,
        "description": "获取用户收藏的所有单词卡",
        "tags": [
          "User",
          "Cards"
        ],
        "parameters": [
          {
            "name": "user_id",
            "in": "path",
            "description": "用户ID（openID）",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "获取收藏列表成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "integer",
                      "example": 200
                    },
                    "message": {
                      "type": "string",
                      "example": "获取收藏列表成功"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "user_id": {
                          "type": "string"
                        },
                        "collected_cards": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/CollectedCard"
                          }
                        },
                        "total_count": {
                          "type": "integer"
                        }
                      }
                    }
                  }
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/users/{user_id}/collected-cards/{word_id}/status": {
      "get": {
        "summary": "检查单词卡收藏状态",
        "deprecated": false,
        "description": "检查指定单词卡是否已被用户收藏",
        "tags": [
          "User",
          "Cards"
        ],
        "parameters": [
          {
            "name": "user_id",
            "in": "path",
            "description": "用户ID（openID）",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "word_id",
            "in": "path",
            "description": "单词ID",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "检查成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "integer",
                      "example": 200
                    },
                    "message": {
                      "type": "string",
                      "example": "检查收藏状态成功"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "word_name": {
                          "type": "string"
                        },
                        "user_id": {
                          "type": "string"
                        },
                        "is_collected": {
                          "type": "boolean"
                        }
                      }
                    }
                  }
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/users/profile": {
      "post": {
        "summary": "更新用户资料",
        "deprecated": false,
        "description": "更新现有用户的详细信息。用户必须先通过 /api/auth 完成登录认证后才能使用此接口。如果用户已有推荐码，则不允许修改推荐码；如果用户没有推荐码，则可以设置推荐码（只能设置一次）。",
        "operationId": "post_users_profile",
        "tags": [
          "User"
        ],
        "parameters": [],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "openID"
                ],
                "properties": {
                  "openID": {
                    "type": "string",
                    "description": "用户openID，必须已存在于系统中",
                    "example": "oGZUI0egBJY1zhBY2E5hrWOjn_fs"
                  },
                  "user_name": {
                    "type": "string",
                    "description": "用户名",
                    "example": "jane_smith"
                  },
                  "user_password": {
                    "type": "string",
                    "description": "用户密码"
                  },
                  "age": {
                    "type": "integer",
                    "description": "年龄",
                    "example": 19
                  },
                  "school": {
                    "type": "string",
                    "description": "学校",
                    "example": "清华大学"
                  },
                  "phone": {
                    "type": "string",
                    "description": "手机号",
                    "example": "13800138000"
                  },
                  "class": {
                    "type": "string",
                    "description": "班级",
                    "example": "计算机科学与技术1班"
                  },
                  "referred_by": {
                    "type": "string",
                    "description": "推荐码（可选，一旦设置不可修改）",
                    "example": "JOHN123"
                  },
                  "city": {
                    "type": "string",
                    "description": "城市"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "用户信息更新成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                },
                "example": {
                  "code": 200,
                  "message": "用户信息更新成功",
                  "data": {
                    "_id": "689f6b2b2b10cc9e91bd4995",
                    "openID": "oI0kY7fAJ8BvFdbClxbyPH84VIzE",
                    "user_name": "cqc",
                    "class": "大一",
                    "age": 19,
                    "school": "清华大学",
                    "phone": "13800138000",
                    "city": "string",
                    "agent_level": 0,
                    "referral_code": "68d77931",
                    "referred_by": "ff7a8b6f",
                    "collected_cards": null,
                    "addresses": null,
                    "progress": {
                      "current_unit": "",
                      "learned_words": null
                    },
                    "is_agent": false,
                    "managed_schools": null,
                    "managed_regions": null,
                    "created_at": "2025-08-16T01:15:23.8225106+08:00",
                    "updated_at": "2025-08-16T01:15:23.8225106+08:00"
                  }
                }
              }
            },
            "headers": {}
          },
          "400": {
            "description": "请求参数错误、用户不存在或推荐码相关错误（如：推荐码无效、用户已有推荐码不允许修改等）",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": []
      }
    },
    "/api/users/{user_id}/avatar": {
      "post": {
        "summary": "上传头像",
        "deprecated": false,
        "description": "上传用户头像，支持jpg、png、webp格式，文件大小限制2MB",
        "operationId": "post_users_user_id_avatar",
        "tags": [
          "User"
        ],
        "parameters": [
          {
            "name": "user_id",
            "in": "path",
            "description": "用户ID（openID）",
            "required": true,
            "example": "ojmU85X2S0dMyA3XUZJnB3CXu6_8",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "avatar": {
                    "type": "string",
                    "format": "binary",
                    "description": "头像文件（支持jpg、png、webp格式，最大2MB）",
                    "example": ""
                  }
                },
                "required": [
                  "avatar"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "头像上传成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "integer",
                      "example": 200
                    },
                    "message": {
                      "type": "string",
                      "example": "头像上传成功"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "avatar_path": {
                          "type": "string",
                          "description": "头像文件路径",
                          "example": "/image/avatar/ojmU85X2S0dMyA3XUZJnB3CXu6_8.jpg"
                        },
                        "user_id": {
                          "type": "string",
                          "description": "用户ID",
                          "example": "ojmU85X2S0dMyA3XUZJnB3CXu6_8"
                        }
                      }
                    }
                  }
                }
              }
            },
            "headers": {}
          },
          "400": {
            "description": "请求错误（文件格式不支持、文件过大等）",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "headers": {}
          },
          "500": {
            "description": "服务器内部错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      },
      "get": {
        "summary": "获取用户头像",
        "deprecated": false,
        "description": "获取用户头像图片文件，直接返回图片二进制数据",
        "operationId": "get_users_user_id_avatar",
        "tags": [
          "User"
        ],
        "parameters": [
          {
            "name": "user_id",
            "in": "path",
            "description": "用户ID（openID）",
            "required": true,
            "example": "ojmU85X2S0dMyA3XUZJnB3CXu6_8",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "头像图片文件",
            "content": {
              "image/jpeg": {
                "schema": {
                  "type": "string",
                  "format": "binary",
                  "description": "JPEG格式的头像图片"
                }
              },
              "image/png": {
                "schema": {
                  "type": "string",
                  "format": "binary",
                  "description": "PNG格式的头像图片"
                }
              },
              "image/webp": {
                "schema": {
                  "type": "string",
                  "format": "binary",
                  "description": "WebP格式的头像图片"
                }
              }
            },
            "headers": {
              "Cache-Control": {
                "description": "禁用缓存，确保获取最新头像",
                "schema": {
                  "type": "string",
                  "example": "no-cache, no-store, must-revalidate"
                }
              },
              "Pragma": {
                "description": "旧版缓存控制",
                "schema": {
                  "type": "string",
                  "example": "no-cache"
                }
              },
              "Expires": {
                "description": "过期时间设为0",
                "schema": {
                  "type": "string",
                  "example": "0"
                }
              }
            }
          },
          "404": {
            "description": "用户不存在或头像文件不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "headers": {}
          },
          "500": {
            "description": "服务器内部错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/users/{user_id}/qrcode": {
      "get": {
        "summary": "获取用户二维码",
        "deprecated": false,
        "description": "获取用户推荐二维码的base64数据",
        "operationId": "get_users_user_id_qrcode",
        "tags": [
          "User"
        ],
        "parameters": [
          {
            "name": "user_id",
            "in": "path",
            "description": "用户ID（openID）",
            "required": true,
            "example": "ojmU85X2S0dMyA3XUZJnB3CXu6_8",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "获取小程序码成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "integer",
                      "example": 200
                    },
                    "message": {
                      "type": "string",
                      "example": "获取小程序码成功"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "qr_code": {
                          "type": "string",
                          "description": "二维码base64数据",
                          "example": "data:image/jpeg;base64,eyJlcnJjb2RlIjo0MDA5NywiZXJybXNnIjoiaW52YWxpZCBhcmdzIHJpZDogNjhhMjI1NzUtNTFlYWRkMGEtMjI0YzM1NDIifQ=="
                        },
                        "scene": {
                          "type": "string",
                          "description": "二维码参数（推荐码）",
                          "example": "123456"
                        }
                      }
                    }
                  }
                }
              }
            },
            "headers": {}
          },
          "404": {
            "description": "用户不存在或二维码不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "headers": {}
          },
          "500": {
            "description": "服务器内部错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/users/{user_id}/addresses": {
      "get": {
        "summary": "获取用户收货地址列表",
        "deprecated": false,
        "description": "获取用户的所有收货地址",
        "tags": [
          "User"
        ],
        "parameters": [
          {
            "name": "user_id",
            "in": "path",
            "description": "用户ID（openID）",
            "required": true,
            "example": "507f1f77bcf86cd799439011",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "获取地址列表成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "integer",
                      "example": 200
                    },
                    "message": {
                      "type": "string",
                      "example": "获取地址列表成功"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "addresses": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/Address"
                          }
                        },
                        "total_count": {
                          "type": "integer",
                          "description": "地址总数"
                        }
                      }
                    }
                  }
                },
                "example": {
                  "code": 200,
                  "message": "获取地址列表成功",
                  "data": {
                    "addresses": [
                      {
                        "_id": "507f1f77bcf86cd799439013",
                        "recipient_name": "张三",
                        "phone": "13800138001",
                        "province": "北京市",
                        "city": "北京市",
                        "district": "海淀区",
                        "street": "中关村大街1号",
                        "postal_code": "100000",
                        "is_default": true
                      }
                    ],
                    "total_count": 1
                  }
                }
              }
            },
            "headers": {}
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "code": 401,
                  "message": "未授权",
                  "error": "请提供有效的访问令牌"
                }
              }
            },
            "headers": {}
          },
          "404": {
            "description": "用户不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "code": 404,
                  "message": "用户不存在",
                  "error": "未找到ID为 507f1f77bcf86cd799439011 的用户"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/users/{user_id}/referral": {
      "get": {
        "summary": "获取用户推荐信息",
        "deprecated": false,
        "description": "获取用户的推荐码和推荐统计信息",
        "operationId": "get_users_user_id_referral",
        "tags": [
          "Referrals"
        ],
        "parameters": [
          {
            "name": "user_id",
            "in": "path",
            "description": "用户ID（openID）",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "获取推荐信息成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ReferralResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/referrals": {
      "post": {
        "summary": "跟踪推荐关系",
        "deprecated": false,
        "description": "记录用户使用推荐码的关系",
        "operationId": "post_referrals",
        "tags": [
          "Referrals"
        ],
        "parameters": [],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "referral_code",
                  "referred_user_id"
                ],
                "properties": {
                  "referral_code": {
                    "type": "string",
                    "description": "推荐码"
                  },
                  "referred_user_id": {
                    "type": "string",
                    "description": "被推荐用户ID（openID）"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "推荐关系记录成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/users/{user_id}/referral/commissions": {
      "get": {
        "summary": "查看返现记录",
        "deprecated": false,
        "description": "获取用户的佣金返现记录",
        "operationId": "get_users_user_id_referral_commissions",
        "tags": [
          "Referrals"
        ],
        "parameters": [
          {
            "name": "user_id",
            "in": "path",
            "description": "用户ID（openID）",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "status",
            "in": "query",
            "description": "佣金状态筛选",
            "required": false,
            "schema": {
              "type": "string",
              "enum": [
                "pending",
                "paid",
                "cancelled"
              ]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "获取返现记录成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CommissionListResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/referrals/validate": {
      "post": {
        "summary": "验证推荐码",
        "deprecated": false,
        "description": "验证推荐码是否有效，并返回推荐人信息",
        "operationId": "post_referrals_validate",
        "tags": [
          "Referrals"
        ],
        "parameters": [],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "referral_code"
                ],
                "properties": {
                  "referral_code": {
                    "type": "string",
                    "description": "要验证的推荐码"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "推荐码验证成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ReferralValidationResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": []
      }
    },
    "/api/wxacode/unlimited": {
      "post": {
        "summary": "生成不限制小程序码",
        "deprecated": false,
        "description": "服务端代理获取不限制小程序码",
        "operationId": "post_wxacode_unlimited",
        "tags": [
          "Referrals"
        ],
        "parameters": [],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "scene"
                ],
                "properties": {
                  "scene": {
                    "type": "string",
                    "description": "场景值，最大32个可见字符"
                  },
                  "page": {
                    "type": "string",
                    "description": "必须是已经发布的小程序存在的页面"
                  },
                  "check_path": {
                    "type": "boolean",
                    "description": "检查page是否存在"
                  },
                  "env_version": {
                    "type": "string",
                    "description": "要打开的小程序版本"
                  },
                  "width": {
                    "type": "integer",
                    "description": "二维码的宽度"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "生成小程序码成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/QRCodeResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/agents/{user_id}/users": {
      "get": {
        "summary": "列出代理管理的用户",
        "deprecated": false,
        "description": "获取代理管理的所有用户列表",
        "operationId": "get_agents_user_id_users",
        "tags": [
          "Agent"
        ],
        "parameters": [
          {
            "name": "user_id",
            "in": "path",
            "description": "代理用户ID（openID）",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "school",
            "in": "query",
            "description": "学校筛选（校代理）",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "region",
            "in": "query",
            "description": "地区筛选（区域代理）",
            "required": false,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "获取管理用户列表成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AgentUserListResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/agents/{user_id}/sales": {
      "get": {
        "summary": "列出所有代理销售数据和佣金",
        "deprecated": false,
        "description": "获取代理的销售统计数据和佣金信息",
        "operationId": "get_agents_user_id_sales",
        "tags": [
          "Agent"
        ],
        "parameters": [
          {
            "name": "user_id",
            "in": "path",
            "description": "代理用户ID（openID）",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "start_date",
            "in": "query",
            "description": "开始日期",
            "required": false,
            "schema": {
              "type": "string",
              "format": "date"
            }
          },
          {
            "name": "end_date",
            "in": "query",
            "description": "结束日期",
            "required": false,
            "schema": {
              "type": "string",
              "format": "date"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "获取销售数据成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AgentSalesResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/agents/{user_id}/withdraw": {
      "post": {
        "summary": "提取佣金",
        "deprecated": false,
        "description": "代理用户申请提取可用佣金。注意：1) 最小提取金额为0.01元；2) 使用新版商家转账API（/v3/fund-app/mch-transfer/transfer-bills，场景ID：1005-佣金报酬）；3) 转账金额≥2元时必须填写收款人姓名进行实名校验；4) 成功创建转账单后可能处于待用户确认状态，需用户在微信中确认收款；5) 如果商户账户资金不足，系统会保留原提现记录和商户单号，用户可稍后重试而不会创建重复记录；6) 每个用户同时只能有一个待处理的提现请求。",
        "operationId": "post_agents_user_id_withdraw",
        "tags": [
          "Agent"
        ],
        "parameters": [
          {
            "name": "user_id",
            "in": "path",
            "description": "代理用户ID（openID）",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "amount"
                ],
                "properties": {
                  "amount": {
                    "type": "number",
                    "minimum": 0.01,
                    "description": "提取金额（通过新版商家转账API直接到微信零钱，场景ID：1005-佣金报酬）。≥2元需实名校验"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "提取申请提交成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/WithdrawResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/agents/{user_id}/commission/dashboard": {
      "get": {
        "summary": "获取代理佣金仪表板",
        "deprecated": false,
        "description": "获取代理佣金统计信息，包括今日收入、月度统计和收入对比",
        "operationId": "get_agents_user_id_commission_dashboard",
        "tags": [
          "Agent"
        ],
        "parameters": [
          {
            "name": "user_id",
            "in": "path",
            "description": "代理用户ID（openID）",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "获取佣金仪表板数据成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CommissionDashboardResponse"
                }
              }
            },
            "headers": {}
          },
          "403": {
            "description": "用户不是代理或权限不足",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/agents/{user_id}/commission/details": {
      "get": {
        "summary": "获取代理佣金明细",
        "deprecated": false,
        "description": "获取代理佣金的详细统计数据，支持按月查询",
        "operationId": "get_agents_user_id_commission_details",
        "tags": [
          "Agent"
        ],
        "parameters": [
          {
            "name": "user_id",
            "in": "path",
            "description": "代理用户ID（openID）",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "months",
            "in": "query",
            "description": "查询月数（1-12个月，默认6个月）",
            "required": false,
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 12,
              "default": 6
            }
          }
        ],
        "responses": {
          "200": {
            "description": "获取佣金明细数据成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CommissionDetailsResponse"
                }
              }
            },
            "headers": {}
          },
          "403": {
            "description": "用户不是代理或权限不足",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/search": {
      "post": {
        "summary": "综合搜索",
        "deprecated": false,
        "description": "支持单词、课本、订单的综合模糊搜索",
        "operationId": "post_search",
        "tags": [
          "Search"
        ],
        "parameters": [],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "query",
                  "type"
                ],
                "properties": {
                  "query": {
                    "type": "string",
                    "description": "搜索关键词",
                    "example": "英语"
                  },
                  "type": {
                    "type": "string",
                    "enum": [
                      "word",
                      "book",
                      "order",
                      "all"
                    ],
                    "description": "搜索类型",
                    "example": "all"
                  },
                  "page": {
                    "type": "integer",
                    "minimum": 1,
                    "default": 1,
                    "description": "页码"
                  },
                  "limit": {
                    "type": "integer",
                    "minimum": 1,
                    "maximum": 100,
                    "default": 20,
                    "description": "每页数量"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "搜索完成",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SearchResponse"
                }
              }
            },
            "headers": {}
          },
          "400": {
            "description": "请求参数错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": []
      }
    },
    "/api/search/words": {
      "get": {
        "summary": "单词模糊搜索",
        "deprecated": false,
        "description": "对单词名称和含义进行模糊搜索",
        "operationId": "get_search_words",
        "tags": [
          "Search"
        ],
        "parameters": [
          {
            "name": "q",
            "in": "query",
            "description": "搜索关键词",
            "required": true,
            "schema": {
              "type": "string",
              "example": "hello"
            }
          },
          {
            "name": "page",
            "in": "query",
            "description": "页码",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 1,
              "minimum": 1
            }
          },
          {
            "name": "limit",
            "in": "query",
            "description": "每页数量",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 20,
              "minimum": 1,
              "maximum": 100
            }
          }
        ],
        "responses": {
          "200": {
            "description": "单词搜索完成",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SearchResponse"
                }
              }
            },
            "headers": {}
          },
          "400": {
            "description": "请求参数错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": []
      }
    },
    "/api/search/books": {
      "get": {
        "summary": "课本模糊搜索",
        "deprecated": false,
        "description": "对课本名称、版本、描述、作者、出版社进行模糊搜索",
        "operationId": "get_search_books",
        "tags": [
          "Search"
        ],
        "parameters": [
          {
            "name": "q",
            "in": "query",
            "description": "搜索关键词",
            "required": true,
            "schema": {
              "type": "string",
              "example": "英语"
            }
          },
          {
            "name": "page",
            "in": "query",
            "description": "页码",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 1,
              "minimum": 1
            }
          },
          {
            "name": "limit",
            "in": "query",
            "description": "每页数量",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 20,
              "minimum": 1,
              "maximum": 100
            }
          }
        ],
        "responses": {
          "200": {
            "description": "课本搜索完成",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SearchResponse"
                }
              }
            },
            "headers": {}
          },
          "400": {
            "description": "请求参数错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": []
      }
    },
    "/api/search/orders": {
      "get": {
        "summary": "订单搜索",
        "deprecated": false,
        "description": "根据商品名称搜索用户订单",
        "operationId": "get_search_orders",
        "tags": [
          "Search"
        ],
        "parameters": [
          {
            "name": "q",
            "in": "query",
            "description": "搜索关键词（商品名称）",
            "required": true,
            "schema": {
              "type": "string",
              "example": "学习卡"
            }
          },
          {
            "name": "user_id",
            "in": "query",
            "description": "用户ID（openID），可选",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "page",
            "in": "query",
            "description": "页码",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 1,
              "minimum": 1
            }
          },
          {
            "name": "limit",
            "in": "query",
            "description": "每页数量",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 20,
              "minimum": 1,
              "maximum": 100
            }
          }
        ],
        "responses": {
          "200": {
            "description": "订单搜索完成",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SearchResponse"
                }
              }
            },
            "headers": {}
          },
          "400": {
            "description": "请求参数错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "headers": {}
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/users/{user_id}/orders/pay": {
      "post": {
        "summary": "创建微信支付订单",
        "deprecated": false,
        "description": "为指定订单创建微信支付",
        "operationId": "post_users_user_id_orders_pay",
        "tags": [
          "Payment"
        ],
        "parameters": [
          {
            "name": "user_id",
            "in": "path",
            "description": "用户ID（openID）",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "order_id"
                ],
                "properties": {
                  "order_id": {
                    "type": "string",
                    "description": "订单ID"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "支付订单创建成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/WechatPayResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/users/{user_id}/refunds": {
      "post": {
        "summary": "申请退款",
        "deprecated": false,
        "description": "为已支付的订单申请退款，支持全额和部分退款",
        "operationId": "post_users_user_id_refunds",
        "tags": [
          "Payment"
        ],
        "parameters": [
          {
            "name": "user_id",
            "in": "path",
            "description": "用户ID（openID）",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RefundRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "退款申请提交成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RefundResponse"
                }
              }
            }
          },
          "400": {
            "description": "请求参数错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "退款申请失败",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      },
      "get": {
        "summary": "获取退款记录",
        "deprecated": false,
        "description": "获取用户的退款记录列表，支持分页",
        "operationId": "get_users_user_id_refunds",
        "tags": [
          "Payment"
        ],
        "parameters": [
          {
            "name": "user_id",
            "in": "path",
            "description": "用户ID（openID）",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "page",
            "in": "query",
            "description": "页码，默认为1",
            "required": false,
            "example": 1,
            "schema": {
              "type": "integer",
              "minimum": 1
            }
          },
          {
            "name": "limit",
            "in": "query",
            "description": "每页记录数，默认为20，最大100",
            "required": false,
            "example": 20,
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100
            }
          }
        ],
        "responses": {
          "200": {
            "description": "获取退款记录成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RefundRecordsResponse"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/users/{user_id}/refunds/{refund_id}": {
      "get": {
        "summary": "获取退款详情",
        "deprecated": false,
        "description": "获取指定退款记录的详细信息",
        "operationId": "get_users_user_id_refunds_refund_id",
        "tags": [
          "Payment"
        ],
        "parameters": [
          {
            "name": "user_id",
            "in": "path",
            "description": "用户ID（openID）",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "refund_id",
            "in": "path",
            "description": "退款单号",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "获取退款详情成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RefundRecord"
                }
              }
            }
          },
          "403": {
            "description": "无权限访问此退款记录",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "退款记录不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/wechat/pay/notify": {
      "post": {
        "summary": "微信支付回调通知",
        "deprecated": false,
        "description": "接收微信支付结果通知。此接口由微信支付系统调用，用于通知商户支付结果。回调URL必须符合微信要求：1) 使用https://或http://开头的完整URL；2) 域名必须外网可访问；3) 不能使用本地IP或内网IP；4) URL不能携带参数。",
        "operationId": "post_wechat_pay_notify",
        "tags": [
          "Payment"
        ],
        "parameters": [
          {
            "name": "Wechatpay-Timestamp",
            "in": "header",
            "description": "微信支付时间戳",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "Wechatpay-Nonce",
            "in": "header",
            "description": "微信支付随机字符串",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "Wechatpay-Signature",
            "in": "header",
            "description": "微信支付签名",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "Wechatpay-Serial",
            "in": "header",
            "description": "微信支付证书序列号",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "description": "微信支付回调数据（加密）",
                "properties": {
                  "id": {
                    "type": "string",
                    "description": "通知ID"
                  },
                  "create_time": {
                    "type": "string",
                    "description": "通知创建时间"
                  },
                  "event_type": {
                    "type": "string",
                    "description": "通知类型"
                  },
                  "resource_type": {
                    "type": "string",
                    "description": "通知数据类型"
                  },
                  "resource": {
                    "type": "object",
                    "description": "通知资源数据",
                    "properties": {
                      "ciphertext": {
                        "type": "string",
                        "description": "加密的资源数据"
                      },
                      "nonce": {
                        "type": "string",
                        "description": "加密使用的随机串"
                      },
                      "associated_data": {
                        "type": "string",
                        "description": "附加数据"
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "处理成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "description": "处理结果代码",
                      "example": "SUCCESS"
                    },
                    "message": {
                      "type": "string",
                      "description": "处理结果消息",
                      "example": ""
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            },
            "headers": {}
          },
          "400": {
            "description": "请求参数错误",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": false
                    },
                    "message": {
                      "type": "string",
                      "example": "缺少必要的微信支付签名头部"
                    },
                    "data": {
                      "type": "object",
                      "properties": {},
                      "nullable": true
                    }
                  }
                }
              }
            },
            "headers": {}
          },
          "500": {
            "description": "服务器内部错误",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": false
                    },
                    "message": {
                      "type": "string",
                      "example": "处理支付回调失败"
                    },
                    "data": {
                      "type": "object",
                      "properties": {},
                      "nullable": true
                    }
                  }
                }
              }
            },
            "headers": {}
          }
        },
        "security": []
      }
    },
    "/api/units/{unit_id}/words": {
      "get": {
        "summary": "根据单元ID获取单词",
        "deprecated": false,
        "description": "根据单元ID获取该单元的所有单词列表，需要用户购买对应书籍的权限",
        "operationId": "get_units_unit_id_words",
        "tags": [
          "Cards"
        ],
        "parameters": [
          {
            "name": "unit_id",
            "in": "path",
            "description": "单元ID",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "获取单词列表成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/WordListResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/words/{word_name}/card": {
      "get": {
        "summary": "根据单词名称获取卡片",
        "deprecated": false,
        "description": "根据单词名称获取单词卡片详细信息（包括图片）",
        "operationId": "get_words_word_name_card",
        "tags": [
          "Cards"
        ],
        "parameters": [
          {
            "name": "word_name",
            "in": "path",
            "description": "单词名称",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "获取单词卡片成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/WordCardResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/words/{word_id}/card": {
      "get": {
        "summary": "根据单词ID获取卡片",
        "deprecated": false,
        "description": "根据单词ID获取单词卡片详细信息（包括图片），需要用户购买对应书籍的权限",
        "operationId": "get_words_word_id_card",
        "tags": [
          "Cards"
        ],
        "parameters": [
          {
            "name": "word_name",
            "in": "path",
            "description": "单词名称",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "word_id",
            "in": "path",
            "description": "",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "获取单词卡片成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/WordCardResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/words": {
      "get": {
        "summary": "通过单元名称和书籍名称获取单词",
        "deprecated": false,
        "description": "通过单元名称和书籍名称获取单词列表",
        "operationId": "get_words",
        "tags": [
          "Cards"
        ],
        "parameters": [
          {
            "name": "unit_name",
            "in": "query",
            "description": "单元名称",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "book_name",
            "in": "query",
            "description": "书籍名称",
            "required": false,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "获取单词列表成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/WordListResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/health": {
      "get": {
        "summary": "健康检查",
        "deprecated": false,
        "description": "检查服务运行状态",
        "operationId": "get_health",
        "tags": [
          "System"
        ],
        "parameters": [],
        "responses": {
          "200": {
            "description": "服务运行正常",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HealthResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": []
      }
    },
    "/api/products": {
      "get": {
        "summary": "获取所有商品",
        "deprecated": false,
        "description": "获取商城中所有可用的商品列表",
        "operationId": "get_products",
        "tags": [
          "Store"
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "description": "页码",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 1
            }
          },
          {
            "name": "limit",
            "in": "query",
            "description": "每页数量",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 20
            }
          }
        ],
        "responses": {
          "200": {
            "description": "获取商品列表成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProductListResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": []
      }
    },
    "/api/product/{product_id}": {
      "get": {
        "summary": "获取特定商品详情",
        "deprecated": false,
        "description": "根据商品ID获取商品的详细信息",
        "operationId": "get_product_product_id",
        "tags": [
          "Store"
        ],
        "parameters": [
          {
            "name": "product_id",
            "in": "path",
            "description": "商品ID",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "获取商品详情成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProductResponse"
                }
              }
            },
            "headers": {}
          },
          "404": {
            "description": "商品不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": []
      }
    },
    "/api/users/{user_id}/cart": {
      "get": {
        "summary": "获取用户购物车",
        "deprecated": false,
        "description": "获取指定用户的购物车信息及商品列表",
        "operationId": "get_users_user_id_cart",
        "tags": [
          "Store"
        ],
        "parameters": [
          {
            "name": "user_id",
            "in": "path",
            "description": "用户ID（openID）",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "获取购物车成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CartResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      },
      "post": {
        "summary": "添加商品到购物车",
        "deprecated": false,
        "description": "将指定商品添加到用户的购物车中",
        "operationId": "post_users_user_id_cart",
        "tags": [
          "Store"
        ],
        "parameters": [
          {
            "name": "user_id",
            "in": "path",
            "description": "用户ID（openID）",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "product_id",
                  "quantity"
                ],
                "properties": {
                  "product_id": {
                    "type": "string",
                    "description": "商品ID"
                  },
                  "quantity": {
                    "type": "integer",
                    "minimum": 1,
                    "description": "商品数量"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "添加到购物车成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CartResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/users/{user_id}/orders": {
      "post": {
        "summary": "从购物车创建订单",
        "deprecated": false,
        "description": "将购物车中的商品创建为订单",
        "operationId": "post_users_user_id_orders",
        "tags": [
          "Store"
        ],
        "parameters": [
          {
            "name": "user_id",
            "in": "path",
            "description": "用户ID（openID）",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "address_id",
                  "payment_method"
                ],
                "properties": {
                  "address_id": {
                    "type": "string",
                    "description": "收货地址ID"
                  },
                  "payment_method": {
                    "type": "string",
                    "enum": [
                      "wechat_pay"
                    ],
                    "description": "支付方式"
                  },
                  "referral_code": {
                    "type": "string",
                    "description": "推荐码（可选）"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "订单创建成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OrderResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      },
      "get": {
        "summary": "获取订单历史",
        "deprecated": false,
        "description": "获取用户的所有订单历史记录",
        "operationId": "get_users_user_id_orders",
        "tags": [
          "Store"
        ],
        "parameters": [
          {
            "name": "user_id",
            "in": "path",
            "description": "用户ID（openID）",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "status",
            "in": "query",
            "description": "订单状态筛选",
            "required": false,
            "schema": {
              "type": "string",
              "enum": [
                "pending",
                "paid",
                "shipped",
                "delivered",
                "cancelled"
              ]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "获取订单历史成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OrderListResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/users/{user_id}/orders/{order_id}": {
      "get": {
        "summary": "获取订单详情",
        "deprecated": false,
        "description": "根据订单ID获取特定订单的详细信息",
        "operationId": "get_users_user_id_orders_order_id",
        "tags": [
          "Store"
        ],
        "parameters": [
          {
            "name": "user_id",
            "in": "path",
            "description": "用户ID（openID）",
            "required": true,
            "example": "wx_openid_123",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "order_id",
            "in": "path",
            "description": "订单ID",
            "required": true,
            "example": "507f1f77bcf86cd799439011",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "获取订单详情成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OrderResponse"
                }
              }
            },
            "headers": {}
          },
          "404": {
            "description": "订单不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/users/{user_id}/direct-purchase": {
      "post": {
        "summary": "直接购买商品",
        "deprecated": false,
        "description": "根据商品ID直接购买商品，无需添加到购物车",
        "operationId": "post_users_user_id_direct_purchase",
        "tags": [
          "Store"
        ],
        "parameters": [
          {
            "name": "user_id",
            "in": "path",
            "description": "用户ID（openID）",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "product_id",
                  "address_id",
                  "payment_method"
                ],
                "properties": {
                  "product_id": {
                    "type": "string",
                    "description": "商品ID"
                  },
                  "quantity": {
                    "type": "integer",
                    "minimum": 1,
                    "default": 1,
                    "description": "购买数量，默认为1"
                  },
                  "address_id": {
                    "type": "string",
                    "description": "收货地址ID"
                  },
                  "payment_method": {
                    "type": "string",
                    "enum": [
                      "wechat_pay"
                    ],
                    "description": "支付方式"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "订单创建成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OrderResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/users/{user_id}/cart/items/{product_id}": {
      "put": {
        "summary": "更新购物车商品数量",
        "deprecated": false,
        "description": "更新购物车中指定商品的数量",
        "tags": [
          "Store"
        ],
        "parameters": [
          {
            "name": "user_id",
            "in": "path",
            "description": "用户ID",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "product_id",
            "in": "path",
            "description": "商品ID",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "quantity"
                ],
                "properties": {
                  "quantity": {
                    "type": "integer",
                    "minimum": 1,
                    "description": "新的商品数量"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "更新购物车成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CartResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      },
      "delete": {
        "summary": "删除购物车商品",
        "deprecated": false,
        "description": "从购物车中删除指定商品",
        "tags": [
          "Store"
        ],
        "parameters": [
          {
            "name": "user_id",
            "in": "path",
            "description": "用户ID",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "product_id",
            "in": "path",
            "description": "商品ID",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "删除商品成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CartResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/users/{user_id}/cart/items/{product_id}/select": {
      "put": {
        "summary": "选择/取消选择购物车商品",
        "deprecated": false,
        "description": "设置购物车中指定商品的选择状态",
        "tags": [
          "Store"
        ],
        "parameters": [
          {
            "name": "user_id",
            "in": "path",
            "description": "用户ID",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "product_id",
            "in": "path",
            "description": "商品ID",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "selected"
                ],
                "properties": {
                  "selected": {
                    "type": "boolean",
                    "description": "是否选中"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "更新选择状态成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CartResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/users/{user_id}/cart/select-all": {
      "put": {
        "summary": "全选/反选购物车商品",
        "deprecated": false,
        "description": "设置购物车中所有商品的选择状态",
        "tags": [
          "Store"
        ],
        "parameters": [
          {
            "name": "user_id",
            "in": "path",
            "description": "用户ID",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "selected"
                ],
                "properties": {
                  "selected": {
                    "type": "boolean",
                    "description": "是否选中"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "全选/反选成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CartResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/users/{user_id}/cart/selected": {
      "get": {
        "summary": "获取选中的购物车商品",
        "deprecated": false,
        "description": "获取购物车中已选中的商品列表",
        "tags": [
          "Store"
        ],
        "parameters": [
          {
            "name": "user_id",
            "in": "path",
            "description": "用户ID",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "获取选中商品成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "message": {
                      "type": "string"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/CartItem"
                      }
                    }
                  }
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/books": {
      "get": {
        "summary": "获取书籍列表",
        "deprecated": false,
        "description": "获取所有可用的教材书籍",
        "operationId": "get_books",
        "tags": [
          "Progress"
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "description": "页码",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 1
            }
          },
          {
            "name": "limit",
            "in": "query",
            "description": "每页数量",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 20
            }
          }
        ],
        "responses": {
          "200": {
            "description": "获取书籍列表成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BookListResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": []
      }
    },
    "/api/users/{user_id}/progress": {
      "get": {
        "summary": "获取用户学习进度",
        "deprecated": false,
        "description": "获取用户当前的学习进度信息",
        "operationId": "get_users_user_id_progress",
        "tags": [
          "Progress"
        ],
        "parameters": [
          {
            "name": "user_id",
            "in": "path",
            "description": "用户ID（openID）",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "获取学习进度成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProgressResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      },
      "put": {
        "summary": "更新用户学习进度",
        "deprecated": false,
        "description": "更新用户的学习进度信息",
        "operationId": "put_users_user_id_progress",
        "tags": [
          "Progress"
        ],
        "parameters": [
          {
            "name": "user_id",
            "in": "path",
            "description": "用户ID（openID）",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "current_unit": {
                    "type": "string",
                    "description": "当前单元"
                  },
                  "learned_words": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "description": "新学会的单词列表"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "学习进度更新成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProgressResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/books/{book_id}/words": {
      "get": {
        "summary": "获取书籍单词",
        "deprecated": false,
        "description": "获取指定书籍的所有单词，需要用户购买对应书籍的权限",
        "operationId": "get_books_book_id_words",
        "tags": [
          "Progress"
        ],
        "parameters": [
          {
            "name": "book_id",
            "in": "path",
            "description": "书籍ID",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "unit_id",
            "in": "query",
            "description": "单元ID筛选",
            "required": false,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "获取单词列表成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/WordListResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/admin/users/{user_id}/agent-level": {
      "put": {
        "summary": "更新用户代理等级",
        "deprecated": false,
        "description": "管理员更新指定用户的代理等级",
        "operationId": "put_admin_users_user_id_agent_level",
        "tags": [
          "Admin"
        ],
        "parameters": [
          {
            "name": "user_id",
            "in": "path",
            "description": "用户ID（openID）",
            "required": true,
            "example": "oNeDf4w8_H-llz6p_KmIjG8W7ADc",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "agent_level"
                ],
                "properties": {
                  "agent_level": {
                    "type": "integer",
                    "description": "代理等级（0为普通用户，大于0为代理）",
                    "example": 1
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "代理等级更新成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "integer",
                      "example": 200
                    },
                    "message": {
                      "type": "string",
                      "example": "代理等级更新成功"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "user_id": {
                          "type": "string",
                          "description": "安全的用户标识符"
                        },
                        "agent_level": {
                          "type": "integer",
                          "description": "更新后的代理等级"
                        },
                        "is_agent": {
                          "type": "boolean",
                          "description": "是否为代理"
                        }
                      }
                    }
                  }
                }
              }
            },
            "headers": {}
          },
          "400": {
            "description": "请求参数错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "headers": {}
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "headers": {}
          },
          "500": {
            "description": "更新代理等级失败",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    }
  },
  "components": {
    "schemas": {
      "WordListResponse": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "description": "响应状态码",
            "example": 200
          },
          "message": {
            "type": "string",
            "description": "响应消息",
            "example": "获取单词列表成功"
          },
          "data": {
            "type": "object",
            "properties": {
              "words": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/Word"
                }
              },
              "total_count": {
                "type": "integer",
                "description": "单词总数"
              }
            }
          }
        }
      },
      "User": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string",
            "description": "用户唯一标识"
          },
          "openID": {
            "type": "string",
            "description": "微信openID，作为主要标识符"
          },
          "user_name": {
            "type": "string",
            "description": "用户名"
          },
          "class": {
            "type": "string",
            "description": "班级"
          },
          "age": {
            "type": "integer",
            "description": "年龄"
          },
          "school": {
            "type": "string",
            "description": "学校"
          },
          "phone": {
            "type": "string",
            "description": "手机号"
          },
          "city": {
            "type": "string",
            "description": "城市"
          },
          "agent_level": {
            "type": "integer",
            "enum": [
              0,
              1,
              2
            ],
            "description": "代理等级 (0: 非代理, 1: 校代理, 2: 区域代理)"
          },
          "referral_code": {
            "type": "string",
            "description": "用户的推荐码"
          },
          "referred_by": {
            "type": "string",
            "description": "使用的推荐码"
          },
          "collected_cards": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CollectedCard"
            },
            "description": "收藏的单词卡列表"
          },
          "unlocked_books": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/BookPermission"
            },
            "description": "已解锁的书籍权限列表"
          },
          "addresses": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Address"
            },
            "description": "地址列表"
          },
          "progress": {
            "$ref": "#/components/schemas/Progress"
          },
          "is_agent": {
            "type": "boolean",
            "description": "是否为代理"
          },
          "agent_type": {
            "type": "string",
            "enum": [
              "school",
              "region"
            ],
            "description": "代理类型"
          },
          "managed_schools": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "代理管理的学校（校代理）"
          },
          "managed_regions": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "代理管理的地区（区域代理）"
          },
          "avatar": {
            "type": "string",
            "description": "用户头像路径",
            "example": "/image/avatar/ojmU85X2S0dMyA3XUZJnB3CXu6_8.jpg"
          },
          "qr_code": {
            "type": "string",
            "description": "用户推荐二维码base64数据",
            "example": "data:image/jpeg;base64,eyJlcnJjb2RlIjo0MDA5NywiZXJybXNnIjoiaW52YWxpZCBhcmdzIHJpZDogNjhhMjI1NzUtNTFlYWRkMGEtMjI0YzM1NDIifQ=="
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "description": "创建时间"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "description": "更新时间"
          }
        }
      },
      "Progress": {
        "type": "object",
        "properties": {
          "current_unit": {
            "type": "string",
            "description": "当前单元"
          },
          "learned_words": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "已学单词列表"
          }
        }
      },
      "Product": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string",
            "description": "商品唯一标识"
          },
          "product_id": {
            "type": "string",
            "description": "商品编号"
          },
          "name": {
            "type": "string",
            "description": "商品名称"
          },
          "price": {
            "type": "number",
            "description": "商品价格"
          },
          "description": {
            "type": "string",
            "description": "商品描述"
          },
          "stock": {
            "type": "integer",
            "description": "库存数量"
          },
          "images": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "商品图片URL列表"
          },
          "product_type": {
            "type": "string",
            "enum": [
              "physical",
              "digital"
            ],
            "description": "商品类型：physical=实体卡，digital=电子卡"
          },
          "product_version": {
            "type": "string",
            "description": "商品版本，如人教版、外研社版等，用于前端tab筛选"
          },
          "book_id": {
            "type": "string",
            "description": "关联的书籍ID"
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "description": "创建时间"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "description": "更新时间"
          }
        }
      },
      "Address": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string",
            "description": "地址唯一标识"
          },
          "user_openid": {
            "type": "string",
            "description": "用户openID"
          },
          "recipient_name": {
            "type": "string",
            "description": "收件人姓名"
          },
          "phone": {
            "type": "string",
            "description": "收件人电话"
          },
          "province": {
            "type": "string",
            "description": "省份"
          },
          "city": {
            "type": "string",
            "description": "城市"
          },
          "district": {
            "type": "string",
            "description": "区县"
          },
          "street": {
            "type": "string",
            "description": "详细地址"
          },
          "postal_code": {
            "type": "string",
            "description": "邮政编码"
          },
          "is_default": {
            "type": "boolean",
            "description": "是否为默认地址"
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "description": "创建时间"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "description": "更新时间"
          }
        }
      },
      "Cart": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string",
            "description": "购物车唯一标识"
          },
          "cart_id": {
            "type": "string",
            "description": "购物车编号"
          },
          "user_openid": {
            "type": "string",
            "description": "用户openID"
          },
          "items": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CartItem"
            }
          },
          "total_amount": {
            "type": "number",
            "description": "总金额（已按微信支付要求舍去到分，最小金额0.01元）"
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "description": "创建时间"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "description": "更新时间"
          }
        }
      },
      "CartItem": {
        "type": "object",
        "properties": {
          "product_id": {
            "type": "string",
            "description": "商品ID"
          },
          "name": {
            "type": "string",
            "description": "商品名称"
          },
          "price": {
            "type": "number",
            "description": "商品单价"
          },
          "quantity": {
            "type": "integer",
            "description": "商品数量"
          },
          "subtotal": {
            "type": "number",
            "description": "小计"
          },
          "selected": {
            "type": "boolean",
            "description": "是否选中用于结算，默认为true"
          }
        }
      },
      "Order": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string",
            "description": "订单唯一标识"
          },
          "user_openid": {
            "type": "string",
            "description": "用户openID"
          },
          "items": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/OrderItem"
            }
          },
          "selected_cart_items": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "记录从购物车选中的商品ID列表，用于支付回调清空"
          },
          "subtotal_amount": {
            "type": "number",
            "description": "商品小计"
          },
          "discount_amount": {
            "type": "number",
            "description": "折扣金额"
          },
          "discount_rate": {
            "type": "number",
            "description": "折扣率"
          },
          "total_amount": {
            "type": "number",
            "description": "订单总价（已按微信支付要求舍去到分，最小金额0.01元）"
          },
          "status": {
            "type": "string",
            "enum": [
              "pending",
              "paid",
              "shipped",
              "delivered",
              "cancelled"
            ],
            "description": "订单状态"
          },
          "address_id": {
            "type": "string",
            "description": "收货地址ID"
          },
          "payment_method": {
            "type": "string",
            "description": "支付方式"
          },
          "referral_code": {
            "type": "string",
            "description": "使用的推荐码"
          },
          "referrer_openid": {
            "type": "string",
            "description": "推荐人openID"
          },
          "transaction_id": {
            "type": "string",
            "description": "微信支付交易ID"
          },
          "paid_at": {
            "type": "string",
            "format": "date-time",
            "description": "支付时间"
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "description": "创建时间"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "description": "更新时间"
          }
        }
      },
      "OrderItem": {
        "type": "object",
        "properties": {
          "product_id": {
            "type": "string",
            "description": "商品ID"
          },
          "quantity": {
            "type": "integer",
            "description": "商品数量"
          },
          "price": {
            "type": "number",
            "description": "商品单价"
          }
        }
      },
      "Referral": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string",
            "description": "推荐码唯一标识"
          },
          "referral_code": {
            "type": "string",
            "description": "推荐码"
          },
          "user_openid": {
            "type": "string",
            "description": "用户openID"
          },
          "used_by": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ReferralUsage"
            },
            "description": "使用该推荐码的用户列表"
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "description": "创建时间"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "description": "更新时间"
          }
        }
      },
      "Commission": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string",
            "description": "佣金唯一标识"
          },
          "commission_id": {
            "type": "string",
            "description": "佣金编号"
          },
          "user_openid": {
            "type": "string",
            "description": "用户openID"
          },
          "amount": {
            "type": "number",
            "description": "佣金金额"
          },
          "date": {
            "type": "string",
            "format": "date-time",
            "description": "佣金日期"
          },
          "status": {
            "type": "string",
            "enum": [
              "pending",
              "paid",
              "cancelled"
            ],
            "description": "佣金状态"
          },
          "type": {
            "type": "string",
            "enum": [
              "referral",
              "agent"
            ],
            "description": "佣金类型"
          },
          "description": {
            "type": "string",
            "description": "佣金描述"
          },
          "order_id": {
            "type": "string",
            "description": "关联订单ID"
          },
          "referred_user_openid": {
            "type": "string",
            "description": "被推荐用户OpenID"
          },
          "referred_user_name": {
            "type": "string",
            "description": "被推荐用户名"
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "description": "创建时间"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "description": "更新时间"
          }
        }
      },
      "Book": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string",
            "description": "书籍唯一标识"
          },
          "book_name": {
            "type": "string",
            "description": "书籍名称",
            "example": "大学英语四级词汇"
          },
          "book_version": {
            "type": "string",
            "description": "书籍版本",
            "example": "2024版"
          },
          "description": {
            "type": "string",
            "description": "书籍描述",
            "example": "涵盖大学英语四级考试所需的核心词汇"
          },
          "level": {
            "type": "string",
            "description": "难度等级",
            "enum": [
              "beginner",
              "intermediate",
              "advanced"
            ],
            "example": "intermediate"
          },
          "total_words": {
            "type": "integer",
            "description": "总单词数",
            "example": 2000
          },
          "units": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Unit"
            },
            "description": "单元列表"
          },
          "cover_image": {
            "type": "string",
            "description": "封面图片URL",
            "example": "https://example.com/book_cover.jpg"
          },
          "author": {
            "type": "string",
            "description": "作者",
            "example": "英语教学专家组"
          },
          "publisher": {
            "type": "string",
            "description": "出版社",
            "example": "教育出版社"
          },
          "publication_date": {
            "type": "string",
            "format": "date-time",
            "description": "出版日期"
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "description": "创建时间"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "description": "更新时间"
          }
        }
      },
      "Unit": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string",
            "description": "单元ID"
          },
          "unit_name": {
            "type": "string",
            "description": "单元名称",
            "example": "Unit 1: Greetings"
          },
          "book_id": {
            "type": "string",
            "description": "所属书籍ID"
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "description": "创建时间"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "description": "更新时间"
          }
        }
      },
      "Word": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "单词唯一标识"
          },
          "word_name": {
            "type": "string",
            "description": "单词名称"
          },
          "word_meaning": {
            "type": "string",
            "description": "单词含义"
          },
          "pronunciation_url": {
            "type": "string",
            "description": "发音文件URL"
          },
          "img_url": {
            "type": "string",
            "description": "图片URL"
          },
          "unit_id": {
            "type": "string",
            "description": "所属单元ID"
          },
          "book_id": {
            "type": "string",
            "description": "所属书籍ID"
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "description": "创建时间"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "description": "更新时间"
          }
        }
      },
      "LoginResponse": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "description": "响应状态码",
            "example": 200
          },
          "message": {
            "type": "string",
            "description": "响应消息",
            "example": "登录成功"
          },
          "data": {
            "type": "object",
            "properties": {
              "token": {
                "type": "string",
                "description": "JWT Token"
              },
              "user": {
                "$ref": "#/components/schemas/User"
              }
            }
          }
        }
      },
      "UserResponse": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "description": "响应状态码",
            "example": 200
          },
          "message": {
            "type": "string",
            "description": "响应消息",
            "example": "操作成功"
          },
          "data": {
            "$ref": "#/components/schemas/User"
          }
        }
      },
      "AddressResponse": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "description": "响应状态码",
            "example": 200
          },
          "message": {
            "type": "string",
            "description": "响应消息",
            "example": "操作成功"
          },
          "data": {
            "$ref": "#/components/schemas/Address"
          }
        }
      },
      "ProductResponse": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "description": "响应状态码",
            "example": 200
          },
          "message": {
            "type": "string",
            "description": "响应消息",
            "example": "操作成功"
          },
          "data": {
            "$ref": "#/components/schemas/Product"
          }
        }
      },
      "ProductListResponse": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "description": "响应状态码",
            "example": 200
          },
          "message": {
            "type": "string",
            "description": "响应消息",
            "example": "操作成功"
          },
          "data": {
            "type": "object",
            "properties": {
              "products": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/Product"
                }
              },
              "pagination": {
                "$ref": "#/components/schemas/Pagination"
              }
            }
          }
        }
      },
      "CartResponse": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "description": "响应状态码",
            "example": 200
          },
          "message": {
            "type": "string",
            "description": "响应消息",
            "example": "操作成功"
          },
          "data": {
            "$ref": "#/components/schemas/Cart"
          }
        }
      },
      "OrderResponse": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "description": "响应状态码",
            "example": 200
          },
          "message": {
            "type": "string",
            "description": "响应消息",
            "example": "操作成功"
          },
          "data": {
            "$ref": "#/components/schemas/Order"
          }
        }
      },
      "OrderListResponse": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "description": "响应状态码",
            "example": 200
          },
          "message": {
            "type": "string",
            "description": "响应消息",
            "example": "操作成功"
          },
          "data": {
            "type": "object",
            "properties": {
              "orders": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/Order"
                }
              },
              "pagination": {
                "$ref": "#/components/schemas/Pagination"
              }
            }
          }
        }
      },
      "ProgressResponse": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "description": "响应状态码",
            "example": 200
          },
          "message": {
            "type": "string",
            "description": "响应消息",
            "example": "操作成功"
          },
          "data": {
            "$ref": "#/components/schemas/Progress"
          }
        }
      },
      "ReferralResponse": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "description": "响应状态码",
            "example": 200
          },
          "message": {
            "type": "string",
            "description": "响应消息",
            "example": "操作成功"
          },
          "data": {
            "$ref": "#/components/schemas/Referral"
          }
        }
      },
      "CommissionListResponse": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "description": "响应状态码",
            "example": 200
          },
          "message": {
            "type": "string",
            "description": "响应消息",
            "example": "操作成功"
          },
          "data": {
            "type": "object",
            "properties": {
              "commissions": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/Commission"
                }
              },
              "total_amount": {
                "type": "number",
                "description": "总金额"
              },
              "pending_amount": {
                "type": "number",
                "description": "待处理金额"
              },
              "paid_amount": {
                "type": "number",
                "description": "已支付金额"
              }
            }
          }
        }
      },
      "AgentUserListResponse": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "description": "响应状态码",
            "example": 200
          },
          "message": {
            "type": "string",
            "description": "响应消息",
            "example": "操作成功"
          },
          "data": {
            "type": "object",
            "properties": {
              "users": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/User"
                }
              },
              "total_users": {
                "type": "integer",
                "description": "用户总数"
              }
            }
          }
        }
      },
      "AgentSalesResponse": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "description": "响应状态码",
            "example": 200
          },
          "message": {
            "type": "string",
            "description": "响应消息",
            "example": "操作成功"
          },
          "data": {
            "type": "object",
            "properties": {
              "sales_summary": {
                "type": "object",
                "properties": {
                  "total_sales": {
                    "type": "number",
                    "description": "总销售额"
                  },
                  "total_orders": {
                    "type": "integer",
                    "description": "总订单数"
                  },
                  "total_commission": {
                    "type": "number",
                    "description": "总佣金"
                  }
                }
              }
            }
          }
        }
      },
      "WithdrawResponse": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "description": "响应状态码",
            "example": 200
          },
          "message": {
            "type": "string",
            "description": "响应消息",
            "example": "操作成功"
          },
          "data": {
            "type": "object",
            "properties": {
              "withdraw_id": {
                "type": "string",
                "description": "提取记录ID"
              },
              "amount": {
                "type": "number",
                "description": "提取金额"
              },
              "status": {
                "type": "string",
                "enum": [
                  "pending",
                  "processing",
                  "completed",
                  "failed"
                ],
                "description": "提取状态"
              }
            }
          }
        }
      },
      "BookListResponse": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "description": "响应状态码",
            "example": 200
          },
          "message": {
            "type": "string",
            "description": "响应消息",
            "example": "获取书籍列表成功"
          },
          "data": {
            "type": "object",
            "properties": {
              "books": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/Book"
                }
              },
              "pagination": {
                "$ref": "#/components/schemas/Pagination"
              }
            }
          }
        }
      },
      "Pagination": {
        "type": "object",
        "properties": {
          "page": {
            "type": "integer",
            "description": "当前页码",
            "example": 1
          },
          "limit": {
            "type": "integer",
            "description": "每页数量",
            "example": 20
          },
          "total": {
            "type": "integer",
            "description": "总记录数",
            "example": 100
          },
          "total_pages": {
            "type": "integer",
            "description": "总页数",
            "example": 5
          }
        }
      },
      "SuccessResponse": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "description": "响应状态码",
            "example": 200
          },
          "message": {
            "type": "string",
            "description": "响应消息",
            "example": "操作成功"
          }
        }
      },
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "description": "错误状态码",
            "example": 400
          },
          "message": {
            "type": "string",
            "description": "错误消息",
            "example": "请求参数错误"
          },
          "error": {
            "type": "string",
            "description": "错误详情",
            "example": "VALIDATION_ERROR"
          }
        }
      },
      "ReferralUsage": {
        "type": "object",
        "properties": {
          "user_openid": {
            "type": "string",
            "description": "用户openID"
          },
          "user_name": {
            "type": "string",
            "description": "用户名"
          },
          "used_at": {
            "type": "string",
            "format": "date-time",
            "description": "使用时间"
          }
        },
        "description": "推荐码使用记录（仅记录注册时的使用关系，佣金记录已分离到独立的commissions集合）"
      },
      "WordCardResponse": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "description": "响应状态码",
            "example": 200
          },
          "message": {
            "type": "string",
            "description": "响应消息",
            "example": "获取单词卡片成功"
          },
          "data": {
            "$ref": "#/components/schemas/Word"
          }
        }
      },
      "ReferralValidationResponse": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "example": 200
          },
          "message": {
            "type": "string",
            "example": "推荐码有效"
          },
          "data": {
            "type": "object",
            "properties": {
              "referral_code": {
                "type": "string"
              },
              "referrer_info": {
                "type": "object",
                "properties": {
                  "user_openid": {
                    "type": "string"
                  },
                  "user_name": {
                    "type": "string"
                  },
                  "school": {
                    "type": "string"
                  }
                }
              },
              "discount_rate": {
                "type": "number",
                "description": "推荐折扣率"
              }
            }
          }
        }
      },
      "QRCodeResponse": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "description": "响应状态码",
            "example": 200
          },
          "message": {
            "type": "string",
            "description": "响应消息",
            "example": "生成小程序码成功"
          },
          "data": {
            "type": "object",
            "properties": {
              "qr_code_url": {
                "type": "string",
                "description": "小程序码图片URL"
              }
            }
          }
        }
      },
      "WechatPayResponse": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "description": "响应状态码",
            "example": 200
          },
          "message": {
            "type": "string",
            "description": "响应消息",
            "example": "支付订单创建成功"
          },
          "data": {
            "type": "object",
            "properties": {
              "prepay_id": {
                "type": "string",
                "description": "预支付交易会话标识"
              },
              "app_id": {
                "type": "string",
                "description": "小程序ID"
              },
              "time_stamp": {
                "type": "string",
                "description": "时间戳"
              },
              "nonce_str": {
                "type": "string",
                "description": "随机字符串"
              },
              "package": {
                "type": "string",
                "description": "扩展字段"
              },
              "sign_type": {
                "type": "string",
                "description": "签名方式"
              },
              "pay_sign": {
                "type": "string",
                "description": "签名"
              }
            }
          }
        }
      },
      "RefundRequest": {
        "type": "object",
        "required": [
          "refund_amount",
          "total_amount"
        ],
        "properties": {
          "transaction_id": {
            "type": "string",
            "description": "微信支付订单号（与out_trade_no二选一）",
            "example": "1217752501201407033233368018"
          },
          "out_trade_no": {
            "type": "string",
            "description": "商户订单号（与transaction_id二选一）",
            "example": "1217752501201407033233368018"
          },
          "refund_amount": {
            "type": "integer",
            "description": "退款金额（分）",
            "example": 100,
            "minimum": 1
          },
          "total_amount": {
            "type": "integer",
            "description": "原订单金额（分）",
            "example": 100,
            "minimum": 1
          },
          "reason": {
            "type": "string",
            "description": "退款原因",
            "example": "商品已售完",
            "maxLength": 80
          },
          "notify_url": {
            "type": "string",
            "description": "退款结果回调URL",
            "example": "https://weixin.qq.com"
          }
        }
      },
      "RefundResponse": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "description": "响应状态码",
            "example": 200
          },
          "message": {
            "type": "string",
            "description": "响应消息",
            "example": "退款申请提交成功"
          },
          "data": {
            "$ref": "#/components/schemas/RefundRecord"
          }
        }
      },
      "RefundRecord": {
        "type": "object",
        "properties": {
          "refund_id": {
            "type": "string",
            "description": "微信支付退款单号",
            "example": "50000000382019052709732678859"
          },
          "out_refund_no": {
            "type": "string",
            "description": "商户退款单号",
            "example": "REFUND_1578987654321"
          },
          "transaction_id": {
            "type": "string",
            "description": "微信支付订单号",
            "example": "1217752501201407033233368018"
          },
          "out_trade_no": {
            "type": "string",
            "description": "商户订单号",
            "example": "1217752501201407033233368018"
          },
          "user_openid": {
            "type": "string",
            "description": "用户OpenID"
          },
          "refund_amount": {
            "type": "integer",
            "description": "退款金额（分）",
            "example": 100
          },
          "total_amount": {
            "type": "integer",
            "description": "原订单金额（分）",
            "example": 100
          },
          "status": {
            "type": "string",
            "description": "退款状态",
            "enum": ["SUCCESS", "CLOSED", "PROCESSING", "ABNORMAL"],
            "example": "SUCCESS"
          },
          "channel": {
            "type": "string",
            "description": "退款渠道",
            "enum": ["ORIGINAL", "BALANCE", "OTHER_BALANCE", "OTHER_BANKCARD"],
            "example": "ORIGINAL"
          },
          "user_received_account": {
            "type": "string",
            "description": "退款入账账户",
            "example": "招商银行信用卡0403"
          },
          "reason": {
            "type": "string",
            "description": "退款原因",
            "example": "商品已售完"
          },
          "success_time": {
            "type": "string",
            "description": "退款成功时间",
            "example": "2020-12-01T16:18:12+08:00"
          },
          "create_time": {
            "type": "string",
            "description": "退款创建时间",
            "example": "2020-12-01T16:18:12+08:00"
          },
          "funds_account": {
            "type": "string",
            "description": "资金账户",
            "enum": ["UNSETTLED", "AVAILABLE", "UNAVAILABLE", "OPERATION", "BASIC", "ECNY_BASIC"],
            "example": "UNSETTLED"
          },
          "amount": {
            "$ref": "#/components/schemas/RefundAmount"
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "description": "记录创建时间"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "description": "记录更新时间"
          }
        }
      },
      "RefundAmount": {
        "type": "object",
        "properties": {
          "total": {
            "type": "integer",
            "description": "订单总金额（分）",
            "example": 100
          },
          "refund": {
            "type": "integer",
            "description": "退款金额（分）",
            "example": 100
          },
          "from": {
            "type": "array",
            "description": "退款出资的账户类型及金额信息",
            "items": {
              "$ref": "#/components/schemas/RefundFundsFrom"
            }
          },
          "payer_total": {
            "type": "integer",
            "description": "用户支付金额（分）",
            "example": 90
          },
          "payer_refund": {
            "type": "integer",
            "description": "用户退款金额（分）",
            "example": 90
          },
          "settlement_refund": {
            "type": "integer",
            "description": "应结退款金额（分）",
            "example": 100
          },
          "settlement_total": {
            "type": "integer",
            "description": "应结订单金额（分）",
            "example": 100
          },
          "discount_refund": {
            "type": "integer",
            "description": "优惠退款金额（分）",
            "example": 10
          },
          "currency": {
            "type": "string",
            "description": "货币类型",
            "example": "CNY"
          }
        }
      },
      "RefundFundsFrom": {
        "type": "object",
        "properties": {
          "account": {
            "type": "string",
            "description": "出资账户类型",
            "enum": ["AVAILABLE", "UNAVAILABLE"],
            "example": "AVAILABLE"
          },
          "amount": {
            "type": "integer",
            "description": "出资金额（分）",
            "example": 444
          }
        }
      },
      "RefundRecordsResponse": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "description": "响应状态码",
            "example": 200
          },
          "message": {
            "type": "string",
            "description": "响应消息",
            "example": "获取退款记录成功"
          },
          "data": {
            "type": "object",
            "properties": {
              "records": {
                "type": "array",
                "description": "退款记录列表",
                "items": {
                  "$ref": "#/components/schemas/RefundRecord"
                }
              },
              "total": {
                "type": "integer",
                "description": "总记录数",
                "example": 100
              },
              "page": {
                "type": "integer",
                "description": "当前页码",
                "example": 1
              },
              "limit": {
                "type": "integer",
                "description": "每页记录数",
                "example": 20
              },
              "total_pages": {
                "type": "integer",
                "description": "总页数",
                "example": 5
              }
            }
          }
        }
      },
      "HealthResponse": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "description": "响应状态码",
            "example": 200
          },
          "message": {
            "type": "string",
            "description": "响应消息",
            "example": "服务运行正常"
          },
          "data": {
            "type": "object",
            "properties": {
              "status": {
                "type": "string",
                "example": "ok"
              }
            }
          }
        }
      },
      "SearchRequest": {
        "type": "object",
        "required": [
          "query",
          "type"
        ],
        "properties": {
          "query": {
            "type": "string",
            "description": "搜索关键词",
            "example": "英语"
          },
          "type": {
            "type": "string",
            "enum": [
              "word",
              "book",
              "order",
              "all"
            ],
            "description": "搜索类型",
            "example": "all"
          },
          "page": {
            "type": "integer",
            "minimum": 1,
            "default": 1,
            "description": "页码"
          },
          "limit": {
            "type": "integer",
            "minimum": 1,
            "maximum": 100,
            "default": 20,
            "description": "每页数量"
          }
        }
      },
      "SearchResponse": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "description": "响应状态码",
            "example": 200
          },
          "message": {
            "type": "string",
            "description": "响应消息",
            "example": "搜索完成"
          },
          "data": {
            "type": "object",
            "properties": {
              "words": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/Word"
                },
                "description": "单词搜索结果"
              },
              "books": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/Book"
                },
                "description": "课本搜索结果"
              },
              "orders": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/Order"
                },
                "description": "订单搜索结果"
              },
              "total": {
                "type": "integer",
                "description": "总结果数量",
                "example": 25
              },
              "page": {
                "type": "integer",
                "description": "当前页码",
                "example": 1
              },
              "limit": {
                "type": "integer",
                "description": "每页数量",
                "example": 20
              }
            }
          }
        }
      },
      "CommissionDashboardResponse": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "description": "响应状态码",
            "example": 200
          },
          "message": {
            "type": "string",
            "description": "响应消息",
            "example": "获取佣金仪表板数据成功"
          },
          "data": {
            "type": "object",
            "properties": {
              "today_income": {
                "type": "number",
                "description": "今日收入",
                "example": 1001.12
              },
              "this_month_income": {
                "type": "number",
                "description": "本月收入",
                "example": 37889.9
              },
              "last_month_income": {
                "type": "number",
                "description": "上月收入",
                "example": 31466.5
              },
              "month_comparison": {
                "type": "number",
                "description": "月度对比（百分比）",
                "example": 20.4
              },
              "available_commission": {
                "type": "number",
                "description": "可提取佣金",
                "example": 8899.9
              },
              "total_commissions": {
                "type": "integer",
                "description": "本月总佣金笔数",
                "example": 156
              }
            }
          }
        }
      },
      "CommissionDetailsResponse": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "description": "响应状态码",
            "example": 200
          },
          "message": {
            "type": "string",
            "description": "响应消息",
            "example": "获取佣金明细数据成功"
          },
          "data": {
            "type": "object",
            "properties": {
              "monthly_data": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "month": {
                      "type": "string",
                      "description": "月份（中文格式）",
                      "example": "2024年6月"
                    },
                    "month_code": {
                      "type": "string",
                      "description": "月份编码",
                      "example": "2024-06"
                    },
                    "income": {
                      "type": "number",
                      "description": "该月收入",
                      "example": 31466.5
                    },
                    "commissions": {
                      "type": "integer",
                      "description": "该月佣金笔数",
                      "example": 89
                    }
                  }
                },
                "description": "月度佣金数据"
              },
              "total_income": {
                "type": "number",
                "description": "总收入",
                "example": 156788.32
              },
              "total_commissions": {
                "type": "integer",
                "description": "总佣金笔数",
                "example": 456
              },
              "period_months": {
                "type": "integer",
                "description": "查询月数",
                "example": 6
              }
            }
          }
        }
      },
      "BookPermission": {
        "type": "object",
        "properties": {
          "book_id": {
            "type": "string",
            "description": "书籍ID"
          },
          "book_name": {
            "type": "string",
            "description": "书籍名称"
          },
          "access_type": {
            "type": "string",
            "enum": [
              "digital",
              "physical"
            ],
            "description": "访问类型：digital=电子版权限，physical=实体版权限（包含电子版）"
          },
          "order_id": {
            "type": "string",
            "description": "购买订单ID"
          },
          "unlocked_at": {
            "type": "string",
            "format": "date-time",
            "description": "解锁时间"
          }
        }
      },
      "CollectedCard": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string",
            "description": "收藏记录ID"
          },
          "word_id": {
            "type": "string",
            "description": "单词ID"
          },
          "word_name": {
            "type": "string",
            "description": "单词名称"
          },
          "collected_at": {
            "type": "string",
            "format": "date-time",
            "description": "收藏时间"
          }
        }
      }
    },
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "description": "请在请求头中添加 Authorization: Bearer {token}"
      }
    }
  },
  "servers": [],
  "security": []
}