<!--pages/wordcard/wordcard.wxml-->
<view class="container">
  <view class="header">
    <text class="title">å•è¯å¡ç‰‡æµ‹è¯•</text>
  </view>

  <!-- æœç´¢ç±»å‹é€‰æ‹© -->
  <view class="section">
    <view class="section-title">é€‰æ‹©æµ‹è¯•ç±»å‹</view>
    <picker range="{{searchOptions}}" range-key="label" value="{{searchType}}" bindchange="onSearchTypeChange">
      <view class="picker">
        {{searchOptions[searchType].label}}
      </view>
    </picker>
  </view>

  <!-- æŒ‰å•å…ƒIDè·å–å•è¯ -->
  <view class="section" wx:if="{{searchType === 0}}">
    <view class="section-title">æŒ‰å•å…ƒIDè·å–å•è¯</view>
    <view class="form">
      <view class="form-item">
        <text class="form-label">å•å…ƒIDï¼š</text>
        <input 
          class="form-input" 
          value="{{unitId}}"
          placeholder="è¯·è¾“å…¥å•å…ƒID (å¦‚: 60f7b1c8e4b0c8a1234567ab)"
          bindinput="onUnitIdInput"
        />
      </view>
      <button class="search-btn" bindtap="getUnitWordsById" disabled="{{loading}}">
        {{loading ? 'è·å–ä¸­...' : 'è·å–å•è¯åˆ—è¡¨'}}
      </button>
    </view>

    <!-- å•è¯åˆ—è¡¨ç»“æœ -->
    <view class="results" wx:if="{{unitWords.length > 0}}">
      <view class="result-title">å•è¯åˆ—è¡¨ ({{unitWords.length}}ä¸ª)</view>
      <view class="words-list">
        <view class="word-item" wx:for="{{unitWords}}" wx:key="id">
          <view class="word-header">
            <text class="word-name" bindtap="copyWord" data-word="{{item.word_name}}">
              {{item.word_name}}
            </text>
            <text class="word-meaning">{{item.word_meaning}}</text>
          </view>
          <view class="word-meta">
            <text class="pronunciation" wx:if="{{item.pronunciation_url}}" 
                  bindtap="playPronunciation" data-url="{{item.pronunciation_url}}">
              ğŸ”Š æ’­æ”¾å‘éŸ³
            </text>
            <text class="unit-info">å•å…ƒ: {{item.unit_id}}</text>
          </view>
          <view class="word-image" wx:if="{{item.img_url}}">
            <image 
              src="{{item.img_url}}" 
              mode="aspectFit" 
              bindtap="previewImage" 
              data-url="{{item.img_url}}"
              lazy-load
            />
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æŒ‰å•å…ƒåç§°è·å–å•è¯ -->
  <view class="section" wx:if="{{searchType === 1}}">
    <view class="section-title">æŒ‰å•å…ƒåç§°è·å–å•è¯</view>
    <view class="form">
      <view class="form-item">
        <text class="form-label">å•å…ƒåç§°ï¼š</text>
        <input 
          class="form-input" 
          value="{{unitName}}"
          placeholder="è¯·è¾“å…¥å•å…ƒåç§° (å¦‚: Unit 1)"
          bindinput="onUnitNameInput"
        />
      </view>
      <view class="form-item">
        <text class="form-label">ä¹¦ç±åç§° (å¯é€‰)ï¼š</text>
        <input 
          class="form-input" 
          value="{{bookName}}"
          placeholder="è¯·è¾“å…¥ä¹¦ç±åç§°"
          bindinput="onBookNameInput"
        />
      </view>
      <button class="search-btn" bindtap="getWordsByUnitName" disabled="{{loading}}">
        {{loading ? 'è·å–ä¸­...' : 'è·å–å•è¯åˆ—è¡¨'}}
      </button>
    </view>

    <!-- æŒ‰åç§°è·å–çš„å•è¯ç»“æœ -->
    <view class="results" wx:if="{{wordsByName.length > 0}}">
      <view class="result-title">å•è¯åˆ—è¡¨ ({{wordsByName.length}}ä¸ª)</view>
      <view class="words-list">
        <view class="word-item" wx:for="{{wordsByName}}" wx:key="id">
          <view class="word-header">
            <text class="word-name" bindtap="copyWord" data-word="{{item.word_name}}">
              {{item.word_name}}
            </text>
            <text class="word-meaning">{{item.word_meaning}}</text>
          </view>
          <view class="word-meta">
            <text class="pronunciation" wx:if="{{item.pronunciation_url}}" 
                  bindtap="playPronunciation" data-url="{{item.pronunciation_url}}">
              ğŸ”Š æ’­æ”¾å‘éŸ³
            </text>
            <text class="book-info">ä¹¦ç±: {{item.book_id}}</text>
          </view>
          <view class="word-image" wx:if="{{item.img_url}}">
            <image 
              src="{{item.img_url}}" 
              mode="aspectFit" 
              bindtap="previewImage" 
              data-url="{{item.img_url}}"
              lazy-load
            />
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æŒ‰å•è¯åç§°è·å–å¡ç‰‡ -->
  <view class="section" wx:if="{{searchType === 2}}">
    <view class="section-title">æŒ‰å•è¯åç§°è·å–å¡ç‰‡</view>
    <view class="form">
      <view class="form-item">
        <text class="form-label">å•è¯åç§°ï¼š</text>
        <input 
          class="form-input" 
          value="{{wordName}}"
          placeholder="è¯·è¾“å…¥å•è¯åç§° (å¦‚: computer)"
          bindinput="onWordNameInput"
        />
      </view>
      <button class="search-btn" bindtap="getWordCard" disabled="{{loading}}">
        {{loading ? 'è·å–ä¸­...' : 'è·å–å•è¯å¡ç‰‡'}}
      </button>
    </view>

    <!-- å•è¯å¡ç‰‡ç»“æœ -->
    <view class="results" wx:if="{{wordCard}}">
      <view class="result-title">å•è¯å¡ç‰‡è¯¦æƒ…</view>
      <view class="word-card">
        <view class="card-header">
          <text class="card-word" bindtap="copyWord" data-word="{{wordCard.word_name}}">
            {{wordCard.word_name}}
          </text>
          <text class="card-meaning">{{wordCard.word_meaning}}</text>
        </view>
        
        <view class="card-pronunciation" wx:if="{{wordCard.pronunciation_url}}">
          <text class="pronunciation-label">å‘éŸ³ï¼š</text>
          <text class="pronunciation-btn" bindtap="playPronunciation" data-url="{{wordCard.pronunciation_url}}">
            ğŸ”Š æ’­æ”¾å‘éŸ³
          </text>
        </view>
        
        <view class="card-image" wx:if="{{wordCard.img_url}}">
          <text class="image-label">é…å›¾ï¼š</text>
          <image 
            src="{{wordCard.img_url}}" 
            mode="aspectFit" 
            class="card-img"
            bindtap="previewImage" 
            data-url="{{wordCard.img_url}}"
            lazy-load
          />
        </view>
        
        <view class="card-meta">
          <view class="meta-item">
            <text class="meta-label">å•å…ƒIDï¼š</text>
            <text class="meta-value">{{wordCard.unit_id}}</text>
          </view>
          <view class="meta-item">
            <text class="meta-label">ä¹¦ç±IDï¼š</text>
            <text class="meta-value">{{wordCard.book_id}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ¸…ç©ºæŒ‰é’® -->
  <view class="section" wx:if="{{unitWords.length > 0 || wordsByName.length > 0 || wordCard}}">
    <button class="clear-btn" bindtap="clearResults">æ¸…ç©ºç»“æœ</button>
  </view>
</view>